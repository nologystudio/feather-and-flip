"use strict";var globalPartialPath="localhost:8888"==window.location.host?"/feather-and-flip/library/partials/":"/sites/all/themes/feflip/library/partials/",formSubmit=window.location.protocol+"//"+window.location.host+"/api/forms",ffAppControllers=angular.module("ffControllers",[]);ffAppControllers.controller("NavCtrl",function(e){var o=$('nav[role="main-navigation"]'),t=$('*[id="get-rates"]'),a=o.find("div.wrapper > ul > li"),n=480,r=a.toArray(),i=!1;angular.forEach(r,function(e){if(!angular.isUndefined(e.children[1])){var o=$(e.children[1]),t="on";$(e).on({mouseenter:function(){o.toggleClass(t)},mouseleave:function(){o.toggleClass(t)}})}}),$(".nav-trigger").on("click",function(){i?o.hide():o.show(),i=!i})}),ffAppControllers.controller("BodyCtrl",function(e){e.user,e.loading=!1,e.error=!1,e.resetPassword=!1,$("li#hotel-reviews > a").on("click",function(){return!1})}),ffAppControllers.controller("CalendarCtrl",function(e){var o=$("#arrival-gallery"),t=$("#departure-gallery");e.year=[],e.getMonth=function(e,o){var t=o,a=new Date(t,e,1),n=new Date(t,e,moment(t+"-"+(e+1),"YYYY-MM").daysInMonth()),r=moment().range(a,n),i={start:0==a.getDay()?6:a.getDay()-1,days:{}};return r.by("days",function(e){i.days[moment(e._d).format("DD")]=moment(e._d).format("MM/DD/YYYY")}),i},e.buildYear=function(){var o=moment().get("year"),t=moment().get("month"),a=new Date(o,t,1),n=new Date(o+1,t,moment(o+1+"-"+t,"YYYY-MM").daysInMonth()),r=moment().range(a,n),i=[];r.by("months",function(o){var t=moment(o._d).get("month"),a=moment(o._d).get("year");e.year.push({name:moment(o._d).format("MMMM")+" "+a,order:e.getMonth(t,a)})})},e.buildYear(),setTimeout(function(){o.sly({horizontal:1,itemNav:"forceCentered",smart:1,activateMiddle:1,mouseDragging:1,touchDragging:0,releaseSwing:1,startAt:0,scrollBy:1,speed:500,elasticBounds:1,prev:o.find('*[rel="prev"]'),next:o.find('*[rel="next"]')}),t.sly({horizontal:1,itemNav:"forceCentered",smart:1,activateMiddle:1,mouseDragging:1,touchDragging:0,releaseSwing:1,startAt:0,scrollBy:1,speed:500,elasticBounds:1,prev:t.find('*[rel="prev"]'),next:t.find('*[rel="next"]')}),o.find('*[rel="prev"]').on("click",function(){t.find('*[rel="prev"]').trigger("click")}),o.find('*[rel="next"]').on("click",function(){t.find('*[rel="next"]').trigger("click")})},1e3)}),ffAppControllers.controller("BookingEngineCtrl",function(e,o){e.path=globalPartialPath+"booking-engine-flow/",e.state=0,e.stepOne=1,e.loading=!1,e.dateIsValid=!0,e.booking=globalPartialPath+"booking-engine.tpl.html",e.bookingSearch=globalPartialPath+"booking-engine-search.tpl.html",e.searchTpl=e.path+"be-search.tpl.html",e.bookingError="",e.stepTpl={0:"",1:e.path+"be-step-1.tpl.html",2:e.path+"be-step-2.tpl.html",3:e.path+"be-step-3.tpl.html",4:e.path+"be-step-4.tpl.html",5:e.path+"be-step-5.tpl.html"},e.roomUnit={adults:1,children:{number:0,ages:[]}},e.bookingInfo={destination:void 0,internalId:void 0,hotelId:void 0,service:void 0,available:!0,checkIn:moment(new Date).add(3,"days").format("MM/DD/YYYY"),checkOut:moment(new Date).add(10,"days").format("MM/DD/YYYY"),rooms:{number:1,info:[angular.copy(e.roomUnit)]}},e.nightlyIsArray=!1,e.roomSelection={},e.customer={name:"",last:"",email:"",phone:"",address:"",postalCode:"",provinceCode:"",stateCode:"",cityCode:"",countryCode:"",cardCode:"",cardCodeName:"",cardNumber:"",cardMonth:"",cardYear:"",cardId:"",legal:!1},e.allowPayments,e.availableRooms={},e.service="",e.checkStepOne=function(){var o=!0,t=$("#step-"+e.state).offset().top-120,a=60;switch(e.stepOne){case 1:var n=$("#dates").height()+60;e.scroll(t),e.resize($("#booking-engine"),n);break;case 2:var n=$("#dates").height()+$("#rooms").height()+120;e.scroll(t+$("#dates").height()+120),e.resize($("#booking-engine"),n);break;case 3:var n=$("#dates").height()+$("#rooms").height()+348*e.bookingInfo.rooms.number+$("#confirmation").height()+140;e.scroll(t+$("#dates").height()+$("#rooms").height()+180),$("#booking-engine").transition({height:n},500,function(){$(this).css({height:"auto"})})}o&&e.stepOne++},e.triggerOverlay=function(){var e="Away we go...",o=$('<div class="status-overlay animated fadeIn"><div class="content animated bounceIn"><small>'+e+"</small></div></div");o.appendTo($("body"))},e.scroll=function(e){$("html,body").delay(250).animate({scrollTop:e},500)},e.resize=function(e,o){e.transition({height:o},500)},e.changeCheckin=function(o){switch(o){case"+":e.bookingInfo.checkIn=moment(e.bookingInfo.checkIn).add(1,"days").format("MM/DD/YYYY");break;case"-":e.bookingInfo.checkIn=moment(e.bookingInfo.checkIn).subtract(1,"days").format("MM/DD/YYYY")}},e.changeCheckout=function(o){switch(o){case"+":e.bookingInfo.checkOut=moment(e.bookingInfo.checkOut).add(1,"days").format("MM/DD/YYYY");break;case"-":e.bookingInfo.checkOut=moment(e.bookingInfo.checkOut).subtract(1,"days").format("MM/DD/YYYY")}},e.dateValidation=function(){var o=$('#arrival button[data-date="'+e.bookingInfo.checkIn+'"],#departure button[data-date="'+e.bookingInfo.checkOut+'"]');return e.dateIsValid=moment(e.bookingInfo.checkIn).isBefore(e.bookingInfo.checkOut),e.$apply(),e.dateIsValid?o.removeClass("warning"):o.addClass("warning"),e.dateIsValid},e.calendarSetter=function(){$('#arrival button[data-date="'+e.bookingInfo.checkIn+'"]').addClass("on"),$('#departure button[data-date="'+e.bookingInfo.checkOut+'"]').addClass("on"),$("#arrival button[data-date]").on("click",function(o){e.bookingInfo.checkIn=$(this).data("date"),$("#arrival button[data-date]").removeClass(),$(this).addClass("on"),e.dateValidation()}),$("#departure button[data-date]").on("click",function(o){e.bookingInfo.checkOut=$(this).data("date"),$("#departure button[data-date]").removeClass(),$(this).addClass("on"),e.dateValidation()})},$('*[rel="destination"],*[id^="destination"]').click(function(o){var t=$(this).attr("id");$('*[rel="destination"],*[id^="destination"]').each(function(){$(this).attr("id")==t?$(this).addClass("on"):$(this).removeClass("on")}),e.bookingInfo.destination=t.split("-")[1],0==e.state&&(e.state++,e.$apply(),e.checkStepOne(),e.calendarSetter()),o.preventDefault()}),$("#get-rates").on("click",function(o){0==e.state&&(e.state++,e.$apply(),e.checkStepOne(),e.calendarSetter()),o.preventDefault()}),e.guestManager=function(o,t,a){switch(a){case"+":"adults"==o&&e.bookingInfo.rooms.info[t].adults++,"children"==o&&(e.bookingInfo.rooms.info[t].children.number++,e.bookingInfo.rooms.info[t].children.ages.push(0));break;case"-":"adults"==o&&e.bookingInfo.rooms.info[t].adults>0&&e.bookingInfo.rooms.info[t].adults--,"children"==o&&e.bookingInfo.rooms.info[t].children.number>0&&(e.bookingInfo.rooms.info[t].children.number--,e.bookingInfo.rooms.info[t].children.ages.shift())}},e.roomManager=function(o){switch(o){case"+":e.bookingInfo.rooms.number++,e.bookingInfo.rooms.info.push(angular.copy(e.roomUnit));break;case"-":e.bookingInfo.rooms.number>1&&(e.bookingInfo.rooms.number--,e.bookingInfo.rooms.info.shift())}},e.ageManager=function(e,o){switch(o){case"+":e+=1;break;case"-":}},e.getRates=function(){var t=$("body").hasClass("hotel");if(e.dateValidation())switch(e.triggerOverlay(),t){case!0:o({method:"POST",url:formSubmit,data:$.param({formID:"hotelDescription",service:e.bookingInfo.service,hotelId:e.bookingInfo.hotelId,internalId:e.bookingInfo.internalId,destination:e.bookingInfo.destination,checkIn:e.bookingInfo.checkIn,checkOut:e.bookingInfo.checkOut,rooms:e.bookingInfo.rooms}),headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:angular.identity}).success(function(e){window.location.href="http://"+window.location.host+"/"+e}).error(function(e,o){});break;case!1:var a=$('section[id="hotel-reviews"]').data("collection"),n;if(_.isUndefined(a))n={formID:"hotelRates",destination:e.bookingInfo.destination,checkIn:e.bookingInfo.checkIn,checkOut:e.bookingInfo.checkOut,rooms:e.bookingInfo.rooms};else{var r=[];$("a.item").each(function(){r.push($(this).data("internalid"))}),n={formID:"collectionsRates",hotelsId:r,collectionId:a,checkIn:e.bookingInfo.checkIn,checkOut:e.bookingInfo.checkOut,rooms:e.bookingInfo.rooms}}o({method:"POST",url:formSubmit,data:$.param(n),headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:angular.identity}).success(function(e){window.location.href="http://"+window.location.host+"/"+e}).error(function(e,o){})}},e.init=function(o,t){_.isEmpty(o)||(e.bookingInfo=o),e.state=t},e.initRate=function(o,t,a){e.state=o,e.bookingInfo.destination=t,e.bookingInfo.internalId=a},$("#hotel-reviews a.item").click(function(t){var a=$(this).data("sabre"),n=$(this).data("expedia"),r=_.isUndefined(a)||_.isUndefined(n)?!1:!0,i=$(".service-overlay"),s=$(this).data("service"),c=$(this).data("hotelid"),l=$(this).data("internalid"),d=function(){e.triggerOverlay(),o({method:"POST",url:formSubmit,data:$.param({formID:"hotelDescription",service:s,hotelId:c,internalId:l,destination:e.bookingInfo.destination,checkIn:e.bookingInfo.checkIn,checkOut:e.bookingInfo.checkOut,rooms:e.bookingInfo.rooms}),headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:angular.identity}).success(function(e){window.location.href="http://"+window.location.host+"/"+e}).error(function(e,o){})};switch(r){case!0:var u=a.split("|"),p=n.split("|");i.find("#sabre-service h4").text(u[0]),i.find("#expedia-service h4").text(p[0]),i.show().transition({opacity:1},function(){$(this).find('button[rel="close"]').on("click",function(){$(this).unbind(),i.transition({opacity:0},function(){$(this).hide()})})}),i.find("div[id]").on("click",function(){s=$(this).attr("id").split("-")[0],c="expedia"==s?p[1]:u[1],d()});break;case!1:_.isUndefined(s)||_.isUndefined(c)||d()}_.isUndefined(s)||t.preventDefault()}),e.getRoomInfo=function(){var o=$('article[id="hotel"]'),t=o.data("result");switch(e.service=o.data("service"),e.service){case"expedia":e.availableRooms=t.HotelRoomAvailabilityResponse,_.isArray(e.availableRooms.HotelRoomResponse)||(e.availableRooms.HotelRoomResponse=[e.availableRooms.HotelRoomResponse]);break;case"sabre":e.availableRooms=t.RoomStay}},e.parseDate=function(e){return moment(e).format("dddd, MMMM Do YYYY")},e.getDateRange=function(e,o){return Math.abs(moment(e).diff(moment(o),"days"))},e.checkCreditCardNumber=function(){for(var o=e.customer.cardNumber,t=0,a=0,n=!1,r=$('*[name="user-cardnumber"]'),i=$("#lh-error"),s=o.length-1;s>=0;s--){var c=o.charAt(s),a=parseInt(c,10);n&&(a*=2)>9&&(a-=9),t+=a,n=!n}t%10==0||/[^0-9-\s]+/.test(o)?(r.removeClass("warning"),i.hide()):(r.addClass("warning"),i.show()),/^4[0-9]{6,}$/.test(o)?(e.customer.cardCodeName="VISA",e.customer.cardCode="VI"):/^5[1-5][0-9]{5,}$/.test(o)?(e.customer.cardCodeName="MASTERCARD",e.customer.cardCode="MC"):/^3[47][0-9]{5,}$/.test(o)?(e.customer.cardCodeName="AMERICAN EXPRESS",e.customer.cardCode="AX"):/^3(?:0[0-5]|[68][0-9])[0-9]{4,}$/.test(o)?(e.customer.cardCodeName="DINERS CLUB",e.customer.cardCode="DC"):/^6(?:011|5[0-9]{2})[0-9]{3,}$/.test(o)?(e.customer.cardCodeName="DISCOVER",e.customer.cardCode="DS"):/^(?:2131|1800|35[0-9]{3})[0-9]{3,}$/.test(o)?(e.customer.cardCodeName="JCB",e.customer.cardCode="JC"):(e.customer.cardCode="x",e.customer.cardCodeName="JCB"),$("#"+e.customer.cardCode).size()>0?($("*.credit-card").removeClass("on"),$("#"+e.customer.cardCode).addClass("on"),$("#pm-error").hide()):($("*.credit-card").removeClass("on"),$("#pm-error").show())},e.checkCreditCardExpiration=function(){var o=$('*[name="user-cardyear"],*[name="user-cardmonth"]'),t=$("#ex-error");moment(e.customer.cardYear+"-"+e.customer.cardMonth+"-01").isBefore(moment(),"year")?(o.addClass("warning"),t.show()):(o.removeClass("warning"),t.hide())},e.selectThis=function(t){var a=$("#step-3").height()+$("#step-3").offset().top-48;e.state=4,e.roomSelection=t,e.nightlyIsArray=_.isArray(e.roomSelection.RateInfos.RateInfo.ChargeableRateInfo.NightlyRatesPerRoom.NightlyRate),$("html,body").delay(300).animate({scrollTop:a},600),"expedia"==e.service&&o({method:"POST",url:formSubmit,data:$.param({formID:"paymentTypes",hotelId:e.availableRooms.hotelId,supplierType:e.roomSelection.supplierType,rateType:e.roomSelection.RateInfos.RateInfo.rateType}),headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:angular.identity}).success(function(o){e.allowPayments=o}).error(function(e,o){})},e.expandRoom=function(e){$("#expedia-room-"+e+" #room-rates").show(),$("#sabre-room-"+e+" #room-rates").show()},e.checkCustomerInfo=function(){return!0},e.getAdultNumber=function(){var o=0;return angular.forEach(e.bookingInfo.rooms.info,function(e){o+=parseInt(e.adults)}),o},e.confirmBooking=function(){var t={formID:"hotelBooking"},a={};switch(e.service){case"expedia":_.extend(t,{firstName:e.customer.name,lastName:e.customer.last,email:e.customer.email,phone:e.customer.phone,service:e.service,roomCode:e.roomSelection.RoomType["@roomCode"],rateCode:e.roomSelection.rateCode,hotelId:e.availableRooms.hotelId,hotelAddress:e.availableRooms.hotelAddress,hotelPhone:$.trim($('li[id="phone"]').text()),checkIn:e.availableRooms.arrivalDate,checkOut:e.availableRooms.departureDate,rooms:e.bookingInfo.rooms,rateKey:e.roomSelection.RateInfos.RateInfo.RoomGroup.rateKey,supplierType:e.roomSelection.supplierType,taxRate:e.roomSelection.RateInfos.RateInfo.taxRate,chargeableRate:e.roomSelection.RateInfos.RateInfo.ChargeableRateInfo["@total"],nightlyRates:e.roomSelection.RateInfos.RateInfo.ChargeableRateInfo.NightlyRatesPerRoom.NightlyRate,cancellationPolicy:e.roomSelection.RateInfos.RateInfo.cancellationPolicy,userAddress:e.customer.address,userPostalCode:e.customer.postalCode,userCountryCode:e.customer.countryCode,userCityCode:e.customer.cityCode,userStateProvinceCode:e.customer.stateCode,creditCardCode:e.customer.cardCode,creditCardNumber:e.customer.cardNumber,creditCardIdentifier:e.customer.cardId,creditCardExpireDate:e.customer.cardYear+"-"+e.customer.cardMonth}),console.log(t);break;case"sabre":var n="G"!=e.roomSelection.GuaranteeSurchargeRequired?"GDPST":"G";_.extend(t,{firstName:e.customer.name,lastName:e.customer.last,email:e.customer.email,phone:e.customer.phone,service:e.service,roomCode:e.roomSelection.RPH,rooms:e.bookingInfo.rooms,numUnit:e.bookingInfo.rooms.number,guaranteeType:n,checkIn:e.availableRooms.TimeSpan.Start,checkOut:e.availableRooms.TimeSpan.End,taxRate:e.roomSelection.Rates.Rate.HotelTotalPricing.TotalTaxes.Amount,chargeableRate:e.roomSelection.Rates.Rate.HotelTotalPricing.Amount,nightlyRates:e.roomSelection.Rates.Rate.HotelTotalPricing.RateRange,userAddress:e.customer.address,userPostalCode:e.customer.postalCode,userCountryCode:e.customer.countryCode,userCityCode:e.customer.cityCode,userStateProvinceCode:e.customer.stateCode,creditCardCode:e.customer.cardCode,creditCardNumber:e.customer.cardNumber,creditCardIdentifier:e.customer.cardId,creditCardExpireDate:e.customer.cardYear+"-"+e.customer.cardMonth})}e.checkCustomerInfo()&&(_.extend(t,e.customer),e.triggerOverlay(),o({method:"POST",url:formSubmit,data:$.param(t),headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:angular.identity}).success(function(o){var t="http://"+window.location.host+"/booking-info/",a="http://"+window.location.host+"/booking-error";switch(e.service){case"expedia":_.isUndefined(o)?window.location.href=a:_.isUndefined(o.HotelRoomReservationResponse.EanWsError)?window.location.href=t+o.HotelRoomReservationResponse.itineraryId:"RECOVERABLE"==o.HotelRoomReservationResponse.EanWsError.handling?(e.bookingError=o.HotelRoomReservationResponse.EanWsError.presentationMessage,$(".status-overlay").remove()):window.location.href=a;break;case"sabre":_.isUndefined(o.Hotel)?window.location.href=a:window.location.href=t+o.Hotel.BasicPropertyInfo.ConfirmationNumber}}).error(function(e,o){}))},e.$watch("state",function(o){switch(o){case 3:e.getRoomInfo()}}),e.cancel=function(t){var a=$(".cancel-confirmation-overlay"),n=a.find("#confirm-cancellation"),r=a.find("#not-confirm-cancellation"),i=a.data("cancellation").split("|");switch(t){case"confirm":a.show().transition({opacity:1},function(){n.on("click",function(){e.cancel()}),r.on("click",function(){e.cancel("close")})});break;case"close":a.transition({opacity:0},function(){$(this).hide(),n.unbind("click"),r.unbind("click")});break;default:a.find("small,button").transition({opacity:0},function(){$(this).is("small")?(a.find("div.content").addClass("animated bounceIn activate"),$(this).text("Away we go...").transition({opacity:1})):$(this).hide()}),o({method:"POST",url:formSubmit,data:$.param({formID:"cancelBooking",userEmail:i[0],itineraryId:i[1],confirmationNumber:i[2],service:i[3]}),headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:angular.identity}).success(function(o){switch(o.error.toLowerCase()){case"":window.location.reload();break;case"missing parameters":case"method not implemented (sabre)":case"something went wrong":case"booking service not passed":e.cancel("close")}}).error(function(e,o){})}}}),ffAppControllers.controller("MapCtrl",function(e,o,t){L.mapbox.accessToken="pk.eyJ1Ijoibm9sb2d5IiwiYSI6IkFBdm5aVEkifQ.ItKi4oQ1-kPhJhedS4QmNg";var a=L.mapbox.map("map","nology.k0cicjhd",{zoomControl:!0,attributionControl:!1,tileLayer:{continuousWorld:!1,noWrap:!1}}).setView([50.402,5.801],3);a.scrollWheelZoom.disable(),a.tap&&a.tap.disable();var n=L.mapbox.featureLayer().addTo(a),r=[],i=$("#weather-carrousel"),s=i.find('*[rel="left"]'),c=i.find('*[rel="right"]');e.destinations={},e.weatherSpots={},e.retrieveDestinations=function(){o({method:"POST",url:formSubmit,data:$.param({formID:"getDestinations"}),headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:angular.identity}).success(function(o){e.destinations=o,e.addDestinations(),e.getWeatherData()}).error(function(e,o){})},e.addDestinations=function(){var o={type:"Feature",geometry:{type:"Point",coordinates:[0,0]},properties:{title:"",icon:{iconUrl:"",iconSize:[38,47],iconAnchor:[19,47],popupAnchor:[0,-10],className:"ff-Pin"}}};angular.forEach(e.destinations,function(e){var t=angular.copy(o);t.geometry.coordinates[0]=e.longitude,t.geometry.coordinates[1]=e.latitude,t.properties.title=e.destination,t.properties.icon.iconUrl="/sites/all/themes/feflip/media/icons/destination-map-pin.png",t.properties.image=e.image.url,t.properties.description=e.description,t.properties.url=e.maptourl,r.push(t)}),n.on("layeradd",function(e){var o=e.layer,t=o.feature,a='<a href="'+t.properties.url+'" class="expanded-destination-pin"><figure><img src="'+t.properties.image+'"/></figure><p>'+t.properties.description+"</p><small>more...</small></a>";o.setIcon(L.icon(t.properties.icon)),o.bindPopup(a,{closeButton:!1,minWidth:300,zoomAnimation:!0,keepInView:!0,autoPan:!0})}),n.setGeoJSON(r)},e.getWeatherData=function(){i.size()>0&&o({method:"GET",url:"http://api.openweathermap.org/data/2.5/group",params:{id:"5412230,4164138,5134295,4568127,4004293,3521342,2986160,5779451,4140963"},headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:angular.identity}).success(function(o){o.cnt>0?(e.weatherSpots=o.list,t(function(){e.setWeatherGallery()},100,!1)):i.hide()}).error(function(){i.hide()})},e.setWeatherGallery=function(){var o=208*e.weatherSpots.length;o>$(window).width()?i.sly({horizontal:!0,itemNav:"basic",activateOn:"click",mouseDragging:1,touchDragging:1,smart:1,startAt:0,scrollBy:1,speed:300,elasticBounds:1,activatePageOn:"click",prevPage:s,nextPage:c}):(i.find("ul").addClass("off"),s.hide(),c.hide())},e.displayMenu=function(){},e.zoomContinent=function(e){switch(e){case"northamerica":a.setView([43.005,-106.436],4);break;case"southamerica":a.setView([-19.891,-65.479],4);break;case"caribbean":a.setView([21.043,-84.683],5);break;case"africa":a.setView([3.513,21.973],4);break;case"asia":a.setView([53.015,73.828],3);break;case"oceania":a.setView([-15.284,125.42],4);break;case"europe":a.setView([50.402,5.801],4);break;default:a.setView([40,0],2)}},$('ul[role="select"] li').on("click",function(){e.zoomContinent($(this).text().toLowerCase().replace(" ",""))}),e.retrieveDestinations(),$("body").hasClass("map-it")&&e.zoomContinent()}),ffAppControllers.controller("FullMapCtrl",function(e,o,t){L.mapbox.accessToken="pk.eyJ1Ijoibm9sb2d5IiwiYSI6IkFBdm5aVEkifQ.ItKi4oQ1-kPhJhedS4QmNg";var a=L.mapbox.map("map","nology.k0cicjhd",{zoomControl:!0,attributionControl:!1,tileLayer:{continuousWorld:!1,noWrap:!1}}).setView([40,0],2);a.touchZoom.disable(),a.doubleClickZoom.disable(),a.scrollWheelZoom.disable(),a.tap&&a.tap.disable();var n=L.mapbox.featureLayer().addTo(a),r=L.mapbox.featureLayer().addTo(a),i=L.mapbox.featureLayer().addTo(a),s=[],c=[],l=[];e.theOrigin="map-it"==window.location.pathname.split("/")[1]?void 0:window.location.pathname.split("/")[1],e.displayMenu=!1,e.destinations={},e.weatherSpots={},e.theBook={},e.theHotels={},e.bookFilter=void 0,e.selectedDestination,e.retrieveDestinations=function(){t({method:"POST",url:formSubmit,data:$.param({formID:"getDestinations"}),headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:angular.identity}).success(function(o){e.destinations=o,e.addDestinations()}).error(function(e,o){})},e.addDestinations=function(){var o={type:"Feature",geometry:{type:"Point",coordinates:[0,0]},properties:{title:"",clickable:!1,icon:{iconUrl:"",iconSize:[38,47],iconAnchor:[19,47],popupAnchor:[0,-10],className:"ff-Pin"}}};angular.forEach(e.destinations,function(t){var a=angular.copy(o);a.geometry.coordinates[0]=t.longitude,a.geometry.coordinates[1]=t.latitude,a.properties.title=t.destination,a.properties.destination=t,a.properties.icon.iconUrl="/sites/all/themes/feflip/media/icons/destination-map-pin.png",a.properties.image=t.image.url,a.properties.description=t.description,a.properties.url=t.maptourl,_.isUndefined(e.theOrigin)?s.push(a):_.isUndefined(e.theOrigin)||e.theOrigin!=t.url.split("/")[1]||e.displayDestination(t)}),n.on("layeradd",function(o){var t=o.layer,a=t.feature,n='<a href="'+a.properties.url+'" class="expanded-destination-pin"><figure><img src="'+a.properties.image+'"/></figure><p>'+a.properties.description+"</p><small>more...</small></a>";t.setIcon(L.icon(a.properties.icon)),t.on("click",function(){e.displayDestination(a.properties.destination)}),_.isUndefined(e.theOrigin)||e.displayDestination(a.properties.destination),t.bindPopup(n,{closeButton:!1,minWidth:300,zoomAnimation:!0,keepInView:!1,autoPan:!0,closeOnClick:!0})}),n.setGeoJSON(s)},e.getAddressBookPerDestination=function(o,n){a.setView([o.latitude,o.longitude],13),c=[];var i={type:"Feature",geometry:{type:"Point",coordinates:[0,0]},properties:{title:"",icon:{iconUrl:"",iconSize:[43,54],iconAnchor:[22,54],popupAnchor:[0,-10],className:"ab-Pin"}}},s=function(){angular.forEach(e.theBook,function(e){var o=angular.copy(i);o.geometry.coordinates[0]=e.longitude,o.geometry.coordinates[1]=e.latitude,o.properties.title=e.title,o.properties.phone=e.phone,o.properties.address=e.address,o.properties.icon.iconUrl="/sites/all/themes/feflip/media/map/"+e.association.toLowerCase()+"-pin.png",o.properties.review=e.review,o.properties.type=e.association.toLowerCase(),_.isUndefined(n)||n!=e.association.toLowerCase()?c.push(o):c.push(o)}),r.on("layeradd",function(e){var o=e.layer,t=o.feature,a='<div class="vertical '+t.properties.type+'"><h1>'+t.properties.title+"</h1>"+t.properties.review+"</div>";o.setIcon(L.icon(t.properties.icon)),void 0!=t.properties.type&&o.bindPopup(a,{closeButton:!1,minWidth:300,zoomAnimation:!0,keepInView:!1,autoPan:!0})}),r.setGeoJSON(c)};t({method:"POST",url:formSubmit,data:$.param({formID:"addressBook",destinationID:o.id}),headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:angular.identity}).success(function(o){e.theBook=o,s()}).error(function(e,o){})},e.getHotelsByDestination=function(o){var a={type:"Feature",geometry:{type:"Point",coordinates:[0,0]},properties:{title:"",icon:{iconUrl:"",iconSize:[43,54],iconAnchor:[22,54],popupAnchor:[0,-10],className:"ab-Pin"}}},n=function(){angular.forEach(e.theHotels,function(e){var o=angular.copy(a);o.geometry.coordinates[0]=e.longitude,o.geometry.coordinates[1]=e.latitude,o.properties.title=e.name,o.properties.icon.iconUrl="/sites/all/themes/feflip/media/icons/destination-map-pin.png",o.properties.image=e.image,o.properties.description=e.hotelDescription,o.properties.url=e.url,l.push(o)}),i.on("layeradd",function(e){var o=e.layer,t=o.feature,a='<a href="'+t.properties.url+'" class="expanded-destination-pin"><figure><img src="'+t.properties.image+'"/></figure><p>'+t.properties.title+"<br>"+t.properties.description+"</p><small>go to hotel...</small></a>";o.setIcon(L.icon(t.properties.icon)),o.on("click",function(){}),o.bindPopup(a,{closeButton:!1,minWidth:300,zoomAnimation:!0,keepInView:!1,autoPan:!0,closeOnClick:!0})}),i.setGeoJSON(l)};t({method:"POST",url:formSubmit,data:$.param({formID:"destinationHotels",destinationID:o.id}),headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:angular.identity}).success(function(o){e.theHotels=o,n()}).error(function(e,o){})},e.displayDestination=function(o){e.step=2,e.selectedDestination=o,e.getAddressBookPerDestination(o),e.getHotelsByDestination(o)},e.displayAddress=function(e){a.setView([e.latitude,e.longitude],20)},e.filterMap=function(o){e.step=3,e.bookFilter=angular.lowercase(o),e.getAddressBookPerDestination(e.selectedDestination,e.bookFilter)},e.printList=function(){},e.zoomMap=function(e){a.setView([e.latitude,e.longitude],16)},e.filterAddress=function(o){return angular.lowercase(o.association)===e.bookFilter},e.displayAside=function(){e.displayMenu=!e.displayMenu,!e.displayMenu},e.zoomContinent=function(e){switch(e){case"northamerica":a.setView([43.005,-106.436],4);break;case"southamerica":a.setView([-19.891,-65.479],4);break;case"caribbean":a.setView([21.043,-84.683],5);break;case"africa":a.setView([3.513,21.973],4);break;case"asia":a.setView([53.015,73.828],3);break;case"oceania":a.setView([-15.284,125.42],4);break;case"europe":a.setView([50.402,5.801],4);break;default:a.setView([40,0],2)}},$('ul[role="select"] li').on("click",function(){e.zoomContinent($(this).text().toLowerCase().replace(" ",""))}),e.retrieveDestinations()}),ffAppControllers.controller("BlogCtrl",function(e,o){var t=$(".feed-wrapper"),a=$("a.quick-entry").toArray();angular.forEach(a,function(e){if(!angular.isUndefined($(e).data("size"))){var o=$(e).data("size"),t=o.split("x"),a=$(e).width(),n=t[1]*a/t[0];$(e).css({width:a+"px",height:n+"px"})}})}),ffAppControllers.controller("InstagramCtrl",function(e,o){}),ffAppControllers.controller("MessengerCtrl",function(e,o){var t=["hidden","signup","loading"];e.messenger=globalPartialPath+"messenger.tpl.html",e.overlay=$(".call-to-action"),e.isLoggedIn=e.$parent.user,e.isLoading=e.$parent.loading,e.triggerState=t[0],e.display=!1,e.resetPassword=e.$parent.resetPassword,e.changePassword=!1,e.triggerOverlay=function(){switch(e.triggerState){case"hidden":e.display=!1;break;case"loading":e.display=!0;break;default:e.display=!0}},e.$watch("isLoggedIn",function(o){o||(e.triggerState=t[1],e.triggerOverlay())}),e.$watch("resetPassword",function(o){o&&(e.triggerState=t[1],e.triggerOverlay())}),e.$watch("changePassword",function(o){o&&(e.triggerState=t[1],e.triggerOverlay())}),e.$watch("isLoading",function(o){o&&(e.triggerState=t[3],e.triggerOverlay())}),$("#change-password").on("click",function(){e.changePassword=!0,e.$apply()})}),ffAppControllers.controller("RegistrationCtrl",function(e,o){e.response=["success","error","error-in-login"],e.types=["sign-up","sign-in","response","reset-password","new-password","change-password"],e.type=e.types[0],e.rMessage="",e.isValid=!0,e.signInError="",e.signUpError="",e.passwordError="",e.loading=!1,e.data={userName:"",userLast:"",userEmail:"",userPassword:"",userRepassword:"",subscribeNewsletter:!0},e.switcher=function(o){e.type=o,e.data={userName:"",userLast:"",userEmail:"",userPassword:"",userRepassword:"",subscribeNewsletter:!0},e.signInError="",e.signUpError="",e.passwordError="",e.rMessage=""},e.closeOverlay=function(){$(".call-to-action").transition({opacity:0},function(){e.$parent.$parent.display=!1,e.$parent.$parent.resetPassword=!1,e.$parent.$parent.triggerState="hidden",e.$parent.$parent.$apply()})},e.checkChangedInput=function(o){var t=function(o,t){var a=$('*[name$="-'+o.split("user")[1].toLowerCase()+'"]'),n="warning";t?(a.addClass(n),e.isValid=!1):a.removeClass(n)};return angular.forEach(e.data,function(e,o){t(o,angular.isUndefined(e))}),e.isValid},e.regSubmit=function(t){o({method:"POST",url:formSubmit,data:$.param(angular.extend({formID:"sign"+t},e.data)),headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:angular.identity}).success(function(o){o.result?window.location.href="http://"+window.location.host:(e.loading=!1,e.signInError="The user or password is incorrect")}).error(function(){})},e.changePassword=function(){var t=$('#password-form input[type="password"]');e.data.userRepassword==e.data.userPassword&&""!=e.data.userPassword?(t.removeClass("warning"),o({method:"POST",url:formSubmit,data:$.param({formID:"updatePassw",newPassw:e.data.userPassword}),headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:angular.identity}).success(function(o){switch(o.error){case"":e.closeOverlay();break;default:e.passwordError="Something went wrong, please try again later"}}).error(function(e){})):t.addClass("warning")},e.sendPasswordEmail=function(){o({method:"POST",url:formSubmit,data:$.param({formID:"resetPassw",userEmail:e.data.userEmail}),headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:angular.identity}).success(function(o){switch(o.error){case"":$("#password-form").transition({opacity:0},function(){e.rMessage="reset-password-success",e.$apply()});break;default:e.passwordError="The email does not exist"}}).error(function(e){})},e.$parent.changePassword&&e.switcher("change-password"),e.$parent.resetPassword&&e.switcher("new-password")}),ffAppControllers.controller("NewsletterCtrl",function(e,o,t){var a="",n=["still","success","error"];e.currentStatus=n[0],e.signUpData={userEmail:""},e.checkChangedInput=function(o){var t=function(e,o){var t=$('*[name$="-'+e.split("user")[1].toLowerCase()+'"]'),a="warning";o?t.addClass(a):t.removeClass(a)};angular.forEach(e.data,function(e,o){t(o,angular.isUndefined(e))})},e.regSubmit=function(){""!=e.signUpData.userEmail&&t({method:"POST",url:formSubmit,data:$.param({formID:"newsletterForm",userEmail:e.signUpData.userEmail}),headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:angular.identity}).success(function(o){e.currentStatus=n[1]}).error(function(){e.currentStatus=n[2]})}}),ffAppControllers.controller("HotelFilterCtrl",function(e,o){var t=$("a.item").toArray(),a=t,n="",r=new Array,i=!0;e.filterHotels=function(e){"f+f favorites"==e&&(e=e.split(" ")[1]),angular.forEach(a,function(o){$(o).hasClass(e)||$(o).remove()}),a=$("a.item").toArray()},e.unfilterHotels=function(e){},e.resetFilters=function(){$("a.item").remove(),_.each(t,function(e){$("#hotel-reviews > div.wrapper").append(e)}),$(o[0]).find("li").each(function(){$(this).removeClass("on")})},$(o[0]).find("li").on("click",function(){var o=$(this).text().toLowerCase();switch($(this).toggleClass("on"),$(this).hasClass("on")){case!0:e.filterHotels(o);break;case!1:e.unfilterHotels(o)}return!1}),$('ul[role="select"] li').on("click",function(){e.resetFilters()})}),ffAppControllers.controller("SlideshowCtrl",function(e,o,t,a){var n=$("#"+o[0].id),r=n.find('*[rel="left"]'),i=n.find('*[rel="right"]');$("body").hasClass("hotel")&&(r=$('div.gallery-ui *[rel="left"]'),i=$('div.gallery-ui *[rel="right"]')),a(function(){switch(n.hasClass("one-item")){case!1:break;case!0:n.hasClass("main")&&n.find("li").css({width:$(window).width()+"px"}),n.hasClass("main")?n.find("li").delay(300).transit({opacity:1},function(){n.sly({horizontal:1,itemNav:"forceCentered",smart:1,activateMiddle:1,mouseDragging:1,touchDragging:1,releaseSwing:1,startAt:0,
scrollBy:1,speed:500,elasticBounds:1,pagesBar:$("div.gallery-ui ul.pages"),activatePageOn:"click",cycleBy:"items",cycleInterval:7e3,pauseOnHover:!0,startPaused:!1,prev:r,next:i})}):n.find("li").delay(300).transit({opacity:1},function(){n.sly({horizontal:1,itemNav:"centered",activateOn:"click",smart:1,activateMiddle:1,mouseDragging:1,touchDragging:1,releaseSwing:1,startAt:0,scrollBy:1,speed:500,elasticBounds:1,pagesBar:$("div.gallery-ui ul.pages"),activatePageOn:"click",cycleBy:"items",cycleInterval:7e3,pauseOnHover:!0,startPaused:!1,prev:r,next:i})}),$(window).on("resize",function(){n.sly("reload")})}},0)}),ffAppControllers.controller("SearchCtrl",function(e,o){e.userSearch="",e.destinations,e.hotels,e.showResult=!1,e.noResult=!1,e.searchSubmit=function(t){o({method:"POST",url:formSubmit,data:$.param({formID:"customSearch",key:e.userSearch}),headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:angular.identity}).success(function(o){o.destinations.length>0||o.hotels.length>0?(e.showResult=!0,e.destinations=o.destinations,e.hotels=o.hotels):e.userSearch.split("").length>0?(e.showResult=!0,e.noResult=!0):(e.showResult=!1,e.noResult=!1)}).error(function(){})}}),ffAppControllers.controller("HotelCtrl",function(e,o){L.mapbox.accessToken="pk.eyJ1Ijoibm9sb2d5IiwiYSI6IkFBdm5aVEkifQ.ItKi4oQ1-kPhJhedS4QmNg";var t;void 0!=t&&t.remove(),t=L.mapbox.map("map","nology.k0cicjhd",{zoomControl:!0,attributionControl:!1,tileLayer:{continuousWorld:!1,noWrap:!1}}),t.touchZoom.disable(),t.doubleClickZoom.disable(),t.scrollWheelZoom.disable(),t.tap&&t.tap.disable();var a=L.mapbox.featureLayer().addTo(t),n=L.mapbox.featureLayer().addTo(t),r=[];e.latLon,e.showMap=!1,e.addHotel=function(){var o={type:"Feature",geometry:{type:"Point",coordinates:[e.latLon[1],e.latLon[0]]},properties:{title:"",icon:{iconUrl:"/sites/all/themes/feflip/media/icons/destination-map-pin.png",iconSize:[38,47],iconAnchor:[19,47],popupAnchor:[0,-10],className:"ff-Pin"}}};a.on("layeradd",function(e){var o=e.layer,t=o.feature;o.setIcon(L.icon(t.properties.icon))}),r.push(o),a.setGeoJSON(r)},e.addItineraryPins=function(){var e={},t={formID:"addressBook",destinationID:$("#map-it").data("destination")},a={type:"Feature",geometry:{type:"Point",coordinates:[0,0]},properties:{title:"",icon:{iconUrl:"",iconSize:[43,54],iconAnchor:[22,54],popupAnchor:[0,-10],className:"ab-Pin"}}},i=function(){angular.forEach(e,function(e){var o=angular.copy(a);o.geometry.coordinates[0]=e.longitude,o.geometry.coordinates[1]=e.latitude,o.properties.title=e.title,o.properties.phone=e.phone,o.properties.address=e.address,o.properties.icon.iconUrl="/sites/all/themes/feflip/media/map/"+e.association.toLowerCase()+"-pin.png",o.properties.review=e.review,o.properties.type=e.association.toLowerCase(),r.push(o)}),n.on("layeradd",function(e){var o=e.layer,t=o.feature,a='<div class="'+t.properties.type+'"><h1>'+t.properties.title+"</h1>"+t.properties.review+"</div>";o.setIcon(L.icon(t.properties.icon)),void 0!=t.properties.type&&o.bindPopup(a,{closeButton:!1,minWidth:300,zoomAnimation:!0,keepInView:!0,autoPan:!0})}),n.setGeoJSON(r)};o({method:"POST",url:formSubmit,data:$.param(t),headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:angular.identity}).success(function(o){e=o,i()}).error(function(e,o){})},e.loadMap=function(o,a){e.latLon=[o,a],e.addHotel(),e.addItineraryPins(),t.setView(e.latLon,19)}}),ffAppControllers.controller("ItineraryCtrl",function(e){var o=100;e.scroll=function(e){$("html,body").delay(250).animate({scrollTop:e},500)},$("header button[rel]").on("click",function(){var t=$(this).attr("rel").toLowerCase(),a=$("#neighborhood-guide").offset().top;$("#neighborhood-guide h4").each(function(){$(this).text().toLowerCase()==t&&e.scroll($(this).offset().top-o)})}),$('button[rel="see-hotel-reviews"]').on("click",function(){$(this).fadeOut(),$("#itinerary").css({"padding-bottom":"0px"}),$("#hotel-reviews").removeClass("hidden"),e.scroll($("#hotel-reviews").offset().top-o-40)})}),ffAppControllers.controller("ContactCtrl",function(e,o){e.data={userName:"",userLast:"",userEmail:"",userDepartment:"",userSubject:"",userMessage:""},e.success=!1,e.submitContact=function(){var t={formID:"contact",firstName:e.data.userName,lastName:e.data.userLast,email:e.data.userEmail,department:e.data.userDepartment,subject:e.data.userSubject,message:e.data.userMessage};o({method:"POST",url:formSubmit,data:$.param(t),headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:angular.identity}).success(function(o){$("#contact-form").transition({opacity:0},function(){e.success=!0,e.$apply()})}).error(function(){})}});