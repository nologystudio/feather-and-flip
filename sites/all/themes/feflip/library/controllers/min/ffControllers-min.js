"use strict";var globalPartialPath="localhost:8888"==window.location.host?"/feather-and-flip/library/partials/":"/sites/all/themes/feflip/library/partials/",formSubmit=window.location.protocol+"//"+window.location.host+"/api/forms",ffAppControllers=angular.module("ffControllers",[]);ffAppControllers.controller("NavCtrl",function(e,t){var o=$('nav[role="main-navigation"]'),a=$('*[id="get-rates"]'),n=o.find("div.wrapper > ul > li"),r=480,i=n.toArray(),s;angular.forEach(i,function(e){if(!angular.isUndefined(e.children[1])){var t=$(e.children[1]),o="on";$(e).on({mouseenter:function(){t.toggleClass(o)},mouseleave:function(){t.toggleClass(o)}})}}),e.setNavigation=function(){var e=o.hasClass("sticky")?65:35,t=o.hasClass("sticky")?50:20;$("#hotel-list").css({width:$(window).width()+"px",marginLeft:-$("#hotel-reviews").offset().left+"px",backgroundPosition:$("#hotel-reviews").offset().left+e+"px top"}),$("#city-guides-list").css({width:$(window).width()+"px",marginLeft:-$("#city-guides").offset().left+"px",backgroundPosition:$("#city-guides").offset().left+t+"px top"})},o.hasClass("sticky")||$(window).scroll(function(){$(this).scrollTop()>=r?o.addClass("sticky"):o.removeClass("sticky"),e.setNavigation()}),setTimeout(function(){e.setNavigation()},1e3)}),ffAppControllers.controller("BodyCtrl",function(e){e.user,e.loading=!1,e.error=!1,e.resetPassword=!1,$("li#hotel-reviews > a").on("click",function(){return!1}),$(window).on("beforeunload",function(){})}),ffAppControllers.controller("CalendarCtrl",function(e){var t=$("#arrival-gallery"),o=$("#departure-gallery");e.year=[],e.getMonth=function(e,t){var o=t,a=new Date(o,e,1),n=new Date(o,e,moment(o+"-"+(e+1),"YYYY-MM").daysInMonth()),r=moment().range(a,n),i={start:0==a.getDay()?6:a.getDay()-1,days:{}};return r.by("days",function(e){i.days[moment(e._d).format("DD")]=moment(e._d).format("MM/DD/YYYY")}),i},e.buildYear=function(){var t=moment().get("year"),o=moment().get("month"),a=new Date(t,o,1),n=new Date(t+1,o,moment(t+1+"-"+o,"YYYY-MM").daysInMonth()),r=moment().range(a,n),i=[];r.by("months",function(t){var o=moment(t._d).get("month"),a=moment(t._d).get("year");e.year.push({name:moment(t._d).format("MMMM")+" "+a,order:e.getMonth(o,a)})})},e.buildYear(),setTimeout(function(){t.sly({horizontal:1,itemNav:"forceCentered",smart:1,activateMiddle:1,mouseDragging:1,touchDragging:0,releaseSwing:1,startAt:0,scrollBy:1,speed:500,elasticBounds:1,prev:t.find('*[rel="prev"]'),next:t.find('*[rel="next"]')}),o.sly({horizontal:1,itemNav:"forceCentered",smart:1,activateMiddle:1,mouseDragging:1,touchDragging:0,releaseSwing:1,startAt:0,scrollBy:1,speed:500,elasticBounds:1,prev:o.find('*[rel="prev"]'),next:o.find('*[rel="next"]')}),t.find('*[rel="prev"]').on("click",function(){o.find('*[rel="prev"]').trigger("click")}),t.find('*[rel="next"]').on("click",function(){o.find('*[rel="next"]').trigger("click")})},1e3)}),ffAppControllers.controller("BookingEngineCtrl",function(e,t,o){e.path=globalPartialPath+"booking-engine-flow/",e.state=0,e.stepOne=1,e.loading=!1,e.dateIsValid=!0,e.booking=globalPartialPath+"booking-engine.tpl.html",e.bookingSearch=globalPartialPath+"booking-engine-search.tpl.html",e.searchTpl=e.path+"be-search.tpl.html",e.bookingError="",e.stepTpl={0:"",1:e.path+"be-step-1.tpl.html",2:e.path+"be-step-2.tpl.html",3:e.path+"be-step-3.tpl.html",4:e.path+"be-step-4.tpl.html",5:e.path+"be-step-5.tpl.html"},e.roomUnit={adults:1,children:{number:0,ages:[]}},e.bookingInfo={destination:void 0,internalId:void 0,hotelId:void 0,service:void 0,available:!0,checkIn:moment(new Date).add(3,"days").format("MM/DD/YYYY"),checkOut:moment(new Date).add(10,"days").format("MM/DD/YYYY"),rooms:{number:1,info:[angular.copy(e.roomUnit)]}},e.nightlyIsArray=!1,e.roomSelection={},e.customer={name:"",last:"",email:"",phone:"",address:"",postalCode:"",provinceCode:"",stateCode:"",cityCode:"",countryCode:"",cardCode:"",cardCodeName:"",cardNumber:"",cardMonth:"",cardYear:"",cardId:"",legal:!1},e.allowPayments,e.availableRooms={},e.service="",e.checkStepOne=function(){var t=!0,o=$("#step-"+e.state).offset().top-120,a=60;switch(e.stepOne){case 1:var n=$("#dates").height()+60;e.scroll(o),e.resize($("#booking-engine"),n);break;case 2:var n=$("#dates").height()+$("#rooms").height()+120;e.scroll(o+$("#dates").height()+120),e.resize($("#booking-engine"),n);break;case 3:var n=$("#dates").height()+$("#rooms").height()+348*e.bookingInfo.rooms.number+$("#confirmation").height()+140;e.scroll(o+$("#dates").height()+$("#rooms").height()+180),$("#booking-engine").transition({height:n},500,function(){$(this).css({height:"auto"})})}t&&e.stepOne++},e.triggerOverlay=function(){var e="Away we go...",t=$('<div class="status-overlay animated fadeIn"><div class="content animated bounceIn"><small>'+e+"</small></div></div");t.appendTo($("body"))},e.scroll=function(e){$("html,body").delay(250).animate({scrollTop:e},500)},e.resize=function(e,t){e.transition({height:t},500)},e.changeCheckin=function(t){switch(t){case"+":e.bookingInfo.checkIn=moment(e.bookingInfo.checkIn).add(1,"days").format("MM/DD/YYYY");break;case"-":e.bookingInfo.checkIn=moment(e.bookingInfo.checkIn).subtract(1,"days").format("MM/DD/YYYY")}},e.changeCheckout=function(t){switch(t){case"+":e.bookingInfo.checkOut=moment(e.bookingInfo.checkOut).add(1,"days").format("MM/DD/YYYY");break;case"-":e.bookingInfo.checkOut=moment(e.bookingInfo.checkOut).subtract(1,"days").format("MM/DD/YYYY")}},e.dateValidation=function(){var t=$('#arrival button[data-date="'+e.bookingInfo.checkIn+'"],#departure button[data-date="'+e.bookingInfo.checkOut+'"]');return e.dateIsValid=moment(e.bookingInfo.checkIn).isBefore(e.bookingInfo.checkOut),e.$apply(),e.dateIsValid?t.removeClass("warning"):t.addClass("warning"),e.dateIsValid},e.calendarSetter=function(){$('#arrival button[data-date="'+e.bookingInfo.checkIn+'"]').addClass("on"),$('#departure button[data-date="'+e.bookingInfo.checkOut+'"]').addClass("on"),$("#arrival button[data-date]").on("click",function(t){e.bookingInfo.checkIn=$(this).data("date"),$("#arrival button[data-date]").removeClass(),$(this).addClass("on"),e.dateValidation()}),$("#departure button[data-date]").on("click",function(t){e.bookingInfo.checkOut=$(this).data("date"),$("#departure button[data-date]").removeClass(),$(this).addClass("on"),e.dateValidation()})},$('*[rel="destination"],*[id^="destination"]').click(function(t){var o=$(this).attr("id");$('*[rel="destination"],*[id^="destination"]').each(function(){$(this).attr("id")==o?$(this).addClass("on"):$(this).removeClass("on")}),e.bookingInfo.destination=o.split("-")[1],0==e.state&&(e.state++,e.$apply(),e.checkStepOne(),e.calendarSetter()),t.preventDefault()}),$("#get-rates").on("click",function(t){0==e.state&&(e.state++,e.$apply(),e.checkStepOne(),e.calendarSetter()),t.preventDefault()}),e.guestManager=function(t,o,a){switch(a){case"+":"adults"==t&&e.bookingInfo.rooms.info[o].adults++,"children"==t&&(e.bookingInfo.rooms.info[o].children.number++,e.bookingInfo.rooms.info[o].children.ages.push(0));break;case"-":"adults"==t&&e.bookingInfo.rooms.info[o].adults>0&&e.bookingInfo.rooms.info[o].adults--,"children"==t&&e.bookingInfo.rooms.info[o].children.number>0&&(e.bookingInfo.rooms.info[o].children.number--,e.bookingInfo.rooms.info[o].children.ages.shift())}},e.roomManager=function(t){switch(t){case"+":e.bookingInfo.rooms.number++,e.bookingInfo.rooms.info.push(angular.copy(e.roomUnit));break;case"-":e.bookingInfo.rooms.number>1&&(e.bookingInfo.rooms.number--,e.bookingInfo.rooms.info.shift())}},e.ageManager=function(e,t){switch(t){case"+":e+=1;break;case"-":}},e.getRates=function(){var t=$("body").hasClass("hotel");if(e.dateValidation())switch(e.triggerOverlay(),t){case!0:o({method:"POST",url:formSubmit,data:$.param({formID:"hotelDescription",service:e.bookingInfo.service,hotelId:e.bookingInfo.hotelId,internalId:e.bookingInfo.internalId,destination:e.bookingInfo.destination,checkIn:e.bookingInfo.checkIn,checkOut:e.bookingInfo.checkOut,rooms:e.bookingInfo.rooms}),headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:angular.identity}).success(function(e){window.location.href="http://"+window.location.host+"/"+e}).error(function(e,t){});break;case!1:var a=$('section[id="hotel-reviews"]').data("collection"),n;if(_.isUndefined(a))n={formID:"hotelRates",destination:e.bookingInfo.destination,checkIn:e.bookingInfo.checkIn,checkOut:e.bookingInfo.checkOut,rooms:e.bookingInfo.rooms};else{var r=[];$("a.item").each(function(){r.push($(this).data("internalid"))}),n={formID:"collectionsRates",hotelsId:r,collectionId:a,checkIn:e.bookingInfo.checkIn,checkOut:e.bookingInfo.checkOut,rooms:e.bookingInfo.rooms}}o({method:"POST",url:formSubmit,data:$.param(n),headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:angular.identity}).success(function(e){window.location.href="http://"+window.location.host+"/"+e}).error(function(e,t){})}},e.init=function(t,o){_.isEmpty(t)||(e.bookingInfo=t),e.state=o},e.initRate=function(t,o,a){e.state=t,e.bookingInfo.destination=o,e.bookingInfo.internalId=a},$("#hotel-reviews a.item").click(function(t){var a=$(this).data("sabre"),n=$(this).data("expedia"),r=_.isUndefined(a)||_.isUndefined(n)?!1:!0,i=$(".service-overlay"),s=$(this).data("service"),c=$(this).data("hotelid"),l=$(this).data("internalid"),d=function(){e.triggerOverlay(),o({method:"POST",url:formSubmit,data:$.param({formID:"hotelDescription",service:s,hotelId:c,internalId:l,destination:e.bookingInfo.destination,checkIn:e.bookingInfo.checkIn,checkOut:e.bookingInfo.checkOut,rooms:e.bookingInfo.rooms}),headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:angular.identity}).success(function(e){window.location.href="http://"+window.location.host+"/"+e}).error(function(e,t){})};switch(r){case!0:var u=a.split("|"),p=n.split("|");i.find("#sabre-service h4").text(u[0]),i.find("#expedia-service h4").text(p[0]),i.show().transition({opacity:1},function(){$(this).find('button[rel="close"]').on("click",function(){$(this).unbind(),i.transition({opacity:0},function(){$(this).hide()})})}),i.find("div[id]").on("click",function(){s=$(this).attr("id").split("-")[0],c="expedia"==s?p[1]:u[1],d()});break;case!1:_.isUndefined(s)||_.isUndefined(c)||d()}_.isUndefined(s)||t.preventDefault()}),e.getRoomInfo=function(){var t=$('article[id="hotel"]'),o=t.data("result"),a=t.data("service"),n=localStorage.getItem("booking");switch(_.isUndefined(o)&&!_.isNull(n)?(o=JSON.parse(localStorage.getItem("booking")),e.service="expedia",localStorage.removeItem("booking")):_.isUndefined(o)||(localStorage.removeItem("booking"),localStorage.setItem("booking",JSON.stringify(o)),e.service=a),e.service){case"expedia":e.availableRooms=o.HotelRoomAvailabilityResponse,_.isArray(e.availableRooms.HotelRoomResponse)||(e.availableRooms.HotelRoomResponse=[e.availableRooms.HotelRoomResponse]);break;case"sabre":e.availableRooms=o.RoomStay}},e.parseDate=function(e){return moment(e).format("dddd, MMMM Do YYYY")},e.getDateRange=function(e,t){return Math.abs(moment(e).diff(moment(t),"days"))},e.checkCreditCardNumber=function(){var t=e.customer.cardNumber,o=0,a=0,n=!1,r=$('*[name="user-cardnumber"]'),i=$("#lh-error");if(!_.isUndefined(t)){for(var s=t.length-1;s>=0;s--){var c=t.charAt(s),a=parseInt(c,10);n&&(a*=2)>9&&(a-=9),o+=a,n=!n}o%10==0||/[^0-9-\s]+/.test(t)?(r.removeClass("warning"),i.hide()):(r.addClass("warning"),i.show())}/^4[0-9]{6,}$/.test(t)?(e.customer.cardCodeName="VISA",e.customer.cardCode="VI"):/^5[1-5][0-9]{5,}$/.test(t)?(e.customer.cardCodeName="MASTERCARD",e.customer.cardCode="MC"):/^3[47][0-9]{5,}$/.test(t)?(e.customer.cardCodeName="AMERICAN EXPRESS",e.customer.cardCode="AX"):/^3(?:0[0-5]|[68][0-9])[0-9]{4,}$/.test(t)?(e.customer.cardCodeName="DINERS CLUB",e.customer.cardCode="DC"):/^6(?:011|5[0-9]{2})[0-9]{3,}$/.test(t)?(e.customer.cardCodeName="DISCOVER",e.customer.cardCode="DS"):/^(?:2131|1800|35[0-9]{3})[0-9]{3,}$/.test(t)?(e.customer.cardCodeName="JCB",e.customer.cardCode="JC"):(e.customer.cardCode="x",e.customer.cardCodeName="JCB"),$("#"+e.customer.cardCode).size()>0?($("*.credit-card").removeClass("on"),$("#"+e.customer.cardCode).addClass("on"),$("#pm-error").hide()):($("*.credit-card").removeClass("on"),$("#pm-error").show())},e.checkCreditCardExpiration=function(){var t=$('*[name="user-cardyear"],*[name="user-cardmonth"]'),o=$("#ex-error");moment(e.customer.cardYear+"-"+e.customer.cardMonth+"-01").isBefore(moment(),"year")?(t.addClass("warning"),o.show()):(t.removeClass("warning"),o.hide())},e.selectThis=function(a){var n=$("#step-3").height()+$("#step-3").offset().top-48;e.state=4,e.roomSelection=a,e.nightlyIsArray=_.isArray(e.roomSelection.RateInfos.RateInfo.ChargeableRateInfo.NightlyRatesPerRoom.NightlyRate),t.$emit("display-overlay",""),$("html,body").delay(300).animate({scrollTop:n},600),"expedia"==e.service&&o({method:"POST",url:formSubmit,data:$.param({formID:"paymentTypes",hotelId:e.availableRooms.hotelId,supplierType:e.roomSelection.supplierType,rateType:e.roomSelection.RateInfos.RateInfo.rateType}),headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:angular.identity}).success(function(t){e.allowPayments=t}).error(function(e,t){})},e.expandRoom=function(e){$("#expedia-room-"+e+" #room-rates").show(),$("#sabre-room-"+e+" #room-rates").show()},e.checkCustomerInfo=function(){return t.$emit("display-overlay",""),e.$parent.user},e.getAdultNumber=function(){var t=0;return angular.forEach(e.bookingInfo.rooms.info,function(e){t+=parseInt(e.adults)}),t},e.confirmBooking=function(){var t={formID:"hotelBooking"},a={};switch(e.service){case"expedia":_.extend(t,{firstName:e.customer.name,lastName:e.customer.last,email:e.customer.email,phone:e.customer.phone,service:e.service,roomCode:e.roomSelection.RoomType["@roomCode"],rateCode:e.roomSelection.rateCode,hotelId:e.availableRooms.hotelId,hotelAddress:e.availableRooms.hotelAddress,hotelPhone:$.trim($('li[id="phone"]').text()),checkIn:e.availableRooms.arrivalDate,checkOut:e.availableRooms.departureDate,rooms:e.bookingInfo.rooms,rateKey:e.roomSelection.RateInfos.RateInfo.RoomGroup.rateKey,supplierType:e.roomSelection.supplierType,taxRate:e.roomSelection.RateInfos.RateInfo.taxRate,chargeableRate:e.roomSelection.RateInfos.RateInfo.ChargeableRateInfo["@total"],nightlyRates:e.roomSelection.RateInfos.RateInfo.ChargeableRateInfo.NightlyRatesPerRoom.NightlyRate,cancellationPolicy:e.roomSelection.RateInfos.RateInfo.cancellationPolicy,userAddress:e.customer.address,userPostalCode:e.customer.postalCode,userCountryCode:e.customer.countryCode,userCityCode:e.customer.cityCode,userStateProvinceCode:e.customer.stateCode,creditCardCode:e.customer.cardCode,creditCardNumber:e.customer.cardNumber,creditCardIdentifier:e.customer.cardId,creditCardExpireDate:e.customer.cardYear+"-"+e.customer.cardMonth});break;case"sabre":var n="G"!=e.roomSelection.GuaranteeSurchargeRequired?"GDPST":"G";_.extend(t,{firstName:e.customer.name,lastName:e.customer.last,email:e.customer.email,phone:e.customer.phone,service:e.service,roomCode:e.roomSelection.RPH,rooms:e.bookingInfo.rooms,numUnit:e.bookingInfo.rooms.number,guaranteeType:n,checkIn:e.availableRooms.TimeSpan.Start,checkOut:e.availableRooms.TimeSpan.End,taxRate:e.roomSelection.Rates.Rate.HotelTotalPricing.TotalTaxes.Amount,chargeableRate:e.roomSelection.Rates.Rate.HotelTotalPricing.Amount,nightlyRates:e.roomSelection.Rates.Rate.HotelTotalPricing.RateRange,userAddress:e.customer.address,userPostalCode:e.customer.postalCode,userCountryCode:e.customer.countryCode,userCityCode:e.customer.cityCode,userStateProvinceCode:e.customer.stateCode,creditCardCode:e.customer.cardCode,creditCardNumber:e.customer.cardNumber,creditCardIdentifier:e.customer.cardId,creditCardExpireDate:e.customer.cardYear+"-"+e.customer.cardMonth})}e.checkCustomerInfo()&&(_.extend(t,e.customer),e.triggerOverlay(),o({method:"POST",url:formSubmit,data:$.param(t),headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:angular.identity}).success(function(t){var o="http://"+window.location.host+"/booking-info/",a="http://"+window.location.host+"/booking-error";switch(e.service){case"expedia":_.isUndefined(t)?window.location.href=a:_.isUndefined(t.HotelRoomReservationResponse.EanWsError)?window.location.href=o+t.HotelRoomReservationResponse.itineraryId:"RECOVERABLE"==t.HotelRoomReservationResponse.EanWsError.handling?(e.bookingError=t.HotelRoomReservationResponse.EanWsError.presentationMessage,$(".status-overlay").remove()):window.location.href=a;break;case"sabre":_.isUndefined(t.Hotel)?window.location.href=a:window.location.href=o+t.Hotel.BasicPropertyInfo.ConfirmationNumber}}).error(function(e,t){}))},e.$watch("state",function(t){switch(t){case 3:e.getRoomInfo()}}),e.cancel=function(t){var a=$(".cancel-confirmation-overlay"),n=a.find("#confirm-cancellation"),r=a.find("#not-confirm-cancellation"),i=a.data("cancellation").split("|");switch(t){case"confirm":a.show().transition({opacity:1},function(){n.on("click",function(){e.cancel()}),r.on("click",function(){e.cancel("close")})});break;case"close":a.transition({opacity:0},function(){$(this).hide(),n.unbind("click"),r.unbind("click")});break;default:a.find("small,button").transition({opacity:0},function(){$(this).is("small")?(a.find("div.content").addClass("animated bounceIn activate"),$(this).text("Away we go...").transition({opacity:1})):$(this).hide()}),o({method:"POST",url:formSubmit,data:$.param({formID:"cancelBooking",userEmail:i[0],itineraryId:i[1],confirmationNumber:i[2],service:i[3]}),headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:angular.identity}).success(function(t){switch(t.error.toLowerCase()){case"":window.location.reload();break;case"missing parameters":case"method not implemented (sabre)":case"something went wrong":case"booking service not passed":e.cancel("close")}}).error(function(e,t){})}}}),ffAppControllers.controller("MapCtrl",function(e,t,o){L.mapbox.accessToken="pk.eyJ1Ijoibm9sb2d5IiwiYSI6IkFBdm5aVEkifQ.ItKi4oQ1-kPhJhedS4QmNg";var a=L.mapbox.map("map","nology.k0cicjhd",{zoomControl:!0,attributionControl:!1,tileLayer:{continuousWorld:!1,noWrap:!1}}).setView([50.402,5.801],4);a.touchZoom.disable(),a.scrollWheelZoom.disable(),a.tap&&a.tap.disable();var n=L.mapbox.featureLayer().addTo(a),r=[],i=$("#weather-carrousel"),s=i.find('*[rel="left"]'),c=i.find('*[rel="right"]');e.destinations={},e.weatherSpots={},e.retrieveDestinations=function(){t({method:"POST",url:formSubmit,data:$.param({formID:"getDestinations"}),headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:angular.identity}).success(function(t){e.destinations=t,e.addDestinations(),e.getWeatherData()}).error(function(e,t){})},e.addDestinations=function(){var t={type:"Feature",geometry:{type:"Point",coordinates:[0,0]},properties:{title:"",icon:{iconUrl:"",iconSize:[38,47],iconAnchor:[19,47],popupAnchor:[0,-10],className:"ff-Pin"}}};angular.forEach(e.destinations,function(e){var o=angular.copy(t);_.isNumber(parseFloat(e.longitude))&&_.isNumber(parseFloat(e.latitude))&&(o.geometry.coordinates[0]=e.longitude,o.geometry.coordinates[1]=e.latitude,o.properties.title=e.destination,o.properties.icon.iconUrl="/sites/all/themes/feflip/media/icons/destination-map-pin.png",o.properties.image=e.image.url,o.properties.description=e.description,o.properties.url=e.maptourl,r.push(o))}),n.on("layeradd",function(e){var t=e.layer,o=t.feature,a='<a href="'+o.properties.url+'" class="expanded-destination-pin"><figure><img src="'+o.properties.image+'"/></figure><p>'+o.properties.description+"</p><small>more...</small></a>";t.setIcon(L.icon(o.properties.icon)),t.bindPopup(a,{closeButton:!1,minWidth:300,zoomAnimation:!0,keepInView:!0,autoPan:!0})}),n.setGeoJSON(r)},e.getWeatherData=function(){},e.setWeatherGallery=function(){var t=208*e.weatherSpots.length;t>$(window).width()?i.sly({horizontal:!0,itemNav:"basic",activateOn:"click",mouseDragging:1,touchDragging:1,smart:1,startAt:0,scrollBy:1,speed:300,elasticBounds:1,activatePageOn:"click",prevPage:s,nextPage:c}):(i.find("ul").addClass("off"),s.hide(),c.hide())},e.displayMenu=function(){$("#map-it aside").toggleClass("on")},e.zoomContinent=function(e){switch(e){case"northamerica":a.setView([43.005,-106.436],4);break;case"southamerica":a.setView([-19.891,-65.479],4);break;case"caribbean":a.setView([21.043,-84.683],5);break;case"africa":a.setView([3.513,21.973],4);break;case"asia":a.setView([53.015,73.828],3);break;case"oceania":a.setView([-15.284,125.42],4);break;case"europe":a.setView([50.402,5.801],4);break;default:a.setView([40,0],2)}},$('ul[role="select"] li').on("click",function(){e.zoomContinent($(this).text().toLowerCase().replace(" ",""))}),e.retrieveDestinations(),$("body").hasClass("map-it")&&e.zoomContinent()}),ffAppControllers.controller("FullMapCtrl",function(e,t,o,a,n){L.mapbox.accessToken="pk.eyJ1Ijoibm9sb2d5IiwiYSI6IkFBdm5aVEkifQ.ItKi4oQ1-kPhJhedS4QmNg";var r=L.mapbox.map("map","nology.k0cicjhd",{zoomControl:!1,attributionControl:!1,tileLayer:{continuousWorld:!1,noWrap:!1}}).setView([40,0],2);new L.Control.Zoom({position:"topright"}).addTo(r),r.touchZoom.disable(),r.doubleClickZoom.disable(),r.scrollWheelZoom.disable(),r.tap&&r.tap.disable();var i=L.mapbox.featureLayer().addTo(r),s=L.mapbox.featureLayer().addTo(r),c=L.mapbox.featureLayer().addTo(r),l=[],d=[],u=[];e.theOrigin="map-it"==window.location.pathname.split("/")[1]?void 0:window.location.pathname.split("/")[1],e.displayMenu=!1,e.destinations={},e.weatherSpots={},e.theBook={},e.theHotels={},e.bookFilter=void 0,e.selectedDestination,e.selectedAB,e.retrieveDestinations=function(){o({method:"POST",url:formSubmit,data:$.param({formID:"getDestinations"}),headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:angular.identity}).success(function(t){e.destinations=t,e.addDestinations()}).error(function(e,t){})},e.addDestinations=function(){var t={type:"Feature",geometry:{type:"Point",coordinates:[0,0]},properties:{title:"",clickable:!1,icon:{iconUrl:"",iconSize:[38,47],iconAnchor:[19,47],popupAnchor:[0,-10],className:"ff-Pin"}}};angular.forEach(e.destinations,function(o){var a=angular.copy(t);_.isNumber(parseFloat(o.longitude))&&_.isNumber(parseFloat(o.latitude))&&(a.geometry.coordinates[0]=o.longitude,a.geometry.coordinates[1]=o.latitude,a.properties.title=o.destination,a.properties.destination=o,a.properties.icon.iconUrl="/sites/all/themes/feflip/media/icons/destination-map-pin.png",a.properties.image=o.image.url,a.properties.description=o.description,a.properties.url=o.maptourl,_.isUndefined(e.theOrigin)?l.push(a):_.isUndefined(e.theOrigin)||e.theOrigin!=o.url.split("/")[1]||e.displayDestination(o))}),i.on("layeradd",function(t){var o=t.layer,a=o.feature,n='<a href="'+a.properties.url+'" class="expanded-destination-pin"><figure><img src="'+a.properties.image+'"/></figure><p>'+a.properties.description+"</p><small>more...</small></a>";o.setIcon(L.icon(a.properties.icon)),o.on("click",function(){e.displayDestination(a.properties.destination)}),_.isUndefined(e.theOrigin)||e.displayDestination(a.properties.destination),o.bindPopup(n,{closeButton:!1,minWidth:300,zoomAnimation:!0,keepInView:!1,autoPan:!0,closeOnClick:!0})}),i.setGeoJSON(l)},e.getAddressBookPerDestination=function(t,i){r.removeLayer(s),r.setView([t.latitude,t.longitude],13),d=[],s=L.mapbox.featureLayer().addTo(r);var c={type:"Feature",geometry:{type:"Point",coordinates:[0,0]},properties:{title:"",icon:{iconUrl:"",iconSize:[43,54],iconAnchor:[22,54],popupAnchor:[0,-10],className:"ab-Pin"}}},l=function(){angular.forEach(e.theBook,function(e){var t=angular.copy(c);_.isNumber(parseFloat(e.longitude))&&_.isNumber(parseFloat(e.latitude))?(t.geometry.coordinates[0]=e.longitude,t.geometry.coordinates[1]=e.latitude,t.properties.title=e.title,t.properties.phone=e.phone,t.properties.address=e.address,t.properties.icon.iconUrl="/sites/all/themes/feflip/media/map/"+e.association.toLowerCase()+"-pin.png",t.properties.review=e.review,t.properties.type=e.association.toLowerCase(),_.isUndefined(i)||i!=e.association.toLowerCase()?_.isUndefined(i)&&d.push(t):d.push(t)):n.warning("This address book has not been placed on the map:"+e.title)}),s.on("layeradd",function(t){var o=t.layer,a=o.feature,n='<div class="vertical '+a.properties.type+'"><h1>'+a.properties.title+"</h1>"+a.properties.review+"</div>";o.setIcon(L.icon(a.properties.icon)),o.on("click",function(){e.displayMenu=!0,e.step=3,e.selectedAB=this.feature.properties.title,e.bookFilter=this.feature.properties.type,e.$apply();var t=$('li[data-title="'+e.selectedAB+'"]'),o=t.offset().top-(t.height()+30);$("#step-3 ul").scrollTop(o)}),void 0!=a.properties.type&&o.bindPopup(n,{closeButton:!1,minWidth:300,zoomAnimation:!0,keepInView:!1,autoPan:!0})}),s.setGeoJSON(d)};o({method:"POST",url:formSubmit,data:$.param({formID:"addressBook",destinationID:t.id}),headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:angular.identity}).success(function(t){e.theBook=t,l(),a(function(){e.displayMenu=!0},500)}).error(function(e,t){})},e.getHotelsByDestination=function(t){var a={type:"Feature",geometry:{type:"Point",coordinates:[0,0]},properties:{title:"",icon:{iconUrl:"",iconSize:[43,54],iconAnchor:[22,54],popupAnchor:[0,-10],className:"ab-Pin"}}},n=function(){angular.forEach(e.theHotels,function(e){var t=angular.copy(a);_.isNumber(parseFloat(e.longitude))&&_.isNumber(parseFloat(e.latitude))&&(t.geometry.coordinates[0]=e.longitude,t.geometry.coordinates[1]=e.latitude,t.properties.title=e.name,t.properties.icon.iconUrl="/sites/all/themes/feflip/media/icons/destination-map-pin.png",t.properties.image=e.image,t.properties.description=e.hotelDescription,t.properties.url=e.url,u.push(t))}),c.on("layeradd",function(e){var t=e.layer,o=t.feature,a='<a href="'+o.properties.url+'" class="expanded-destination-pin"><figure><img src="'+o.properties.image+'"/></figure><p>'+o.properties.title+"<br>"+o.properties.description+"</p><small>go to hotel...</small></a>";t.setIcon(L.icon(o.properties.icon)),t.on("click",function(){}),t.bindPopup(a,{closeButton:!1,minWidth:300,zoomAnimation:!0,keepInView:!1,autoPan:!0,closeOnClick:!0})}),c.setGeoJSON(u)};o({method:"POST",url:formSubmit,data:$.param({formID:"destinationHotels",destinationID:t.id}),headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:angular.identity}).success(function(t){e.theHotels=t,n()}).error(function(e,t){})},e.displayDestination=function(t){e.step=2,e.selectedDestination=t,e.getAddressBookPerDestination(t),e.getHotelsByDestination(t)},e.displayAddress=function(e){r.setView([e.latitude,e.longitude],20)},e.filterMap=function(t){e.step=3,e.bookFilter=angular.lowercase(t),e.getAddressBookPerDestination(e.selectedDestination,e.bookFilter)},e.printList=function(){},e.goToFullList=function(){e.step=1,console.log("entrada")},e.zoomMap=function(e){r.setView([e.latitude,e.longitude],16)},e.filterAddress=function(t){return t.association.toLowerCase()===e.bookFilter||_.isUndefined(e.bookFilter)?!0:!1},e.displayAside=function(){e.displayMenu=!e.displayMenu},e.zoomContinent=function(e){switch(e){case"northamerica":r.setView([43.005,-106.436],4);break;case"southamerica":r.setView([-19.891,-65.479],4);break;case"caribbean":r.setView([21.043,-84.683],5);break;case"africa":r.setView([3.513,21.973],4);break;case"asia":r.setView([53.015,73.828],3);break;case"oceania":r.setView([-15.284,125.42],4);break;case"europe":r.setView([50.402,5.801],4);break;default:r.setView([40,0],2)}},$('ul[role="select"] li').on("click",function(){e.zoomContinent($(this).text().toLowerCase().replace(" ",""))}),e.retrieveDestinations()}),ffAppControllers.controller("BlogCtrl",function(e,t,o){var a=$(".feed-wrapper"),n=$("a.quick-entry").toArray();angular.forEach(n,function(e){if(!angular.isUndefined($(e).data("size"))){var t=$(e).data("size"),o=t.split("x"),a=$(e).width(),n=o[1]*a/o[0];$(e).css({width:a+"px",height:n+"px"})}}),o(function(){a.shuffle({itemSelector:".quick-entry"})},0)}),ffAppControllers.controller("InstagramCtrl",function(e,t){e.feed,e.lastImage=""}),ffAppControllers.controller("MessengerCtrl",function(e,t,o,a){var n=["hidden","signup","loading"];e.messenger=globalPartialPath+"messenger.tpl.html",e.overlay=$(".call-to-action"),e.isLoggedIn=e.$parent.user,e.isLoading=e.$parent.loading,e.triggerState=n[0],e.display=!1,e.resetPassword=e.$parent.resetPassword,e.changePassword=!1,e.triggerOverlay=function(){if("hidden"!=a.get("overlay"))switch(e.triggerState){case"hidden":e.display=!1;break;case"loading":e.display=!0;break;default:e.display=!0}},e.$watch("isLoggedIn",function(t){t||(e.triggerState=n[1],e.triggerOverlay())}),e.$watch("resetPassword",function(t){t&&(e.triggerState=n[1],e.triggerOverlay())}),e.$watch("changePassword",function(t){t&&(e.triggerState=n[1],e.triggerOverlay())}),e.$watch("isLoading",function(t){t&&(e.triggerState=n[3],e.triggerOverlay())}),t.$on("display-overlay",function(t,o){e.$parent.user||(a.put("overlay","signup",{path:"/"}),e.triggerState=n[1],e.triggerOverlay(),$(".call-to-action").transition({opacity:1}))}),$("#change-password").on("click",function(t){e.changePassword=!0,e.$apply(),t.preventDefault()}),$("#sign-in").on("click",function(o){t.$emit("display-overlay",""),e.$apply(),o.preventDefault()})}),ffAppControllers.controller("RegistrationCtrl",function(e,t,o){e.response=["success","error","error-in-login"],e.types=["sign-up","sign-in","response","reset-password","new-password","change-password"],e.type=e.types[0],e.rMessage="",e.isValid=!0,e.signInError="",e.signUpError="",e.passwordError="",e.loading=!1,e.data={userName:"",userLast:"",userEmail:"",userPassword:"",userRepassword:"",subscribeNewsletter:!0},e.switcher=function(t){e.type=t,e.data={userName:"",userLast:"",userEmail:"",userPassword:"",userRepassword:"",subscribeNewsletter:!0},e.signInError="",e.signUpError="",e.passwordError="",e.rMessage=""},e.closeOverlay=function(){$(".call-to-action").transition({opacity:0},function(){e.$parent.$parent.$parent.display=!1,e.$parent.$parent.$parent.resetPassword=!1,e.$parent.$parent.$parent.triggerState="hidden",e.$parent.$parent.$parent.$apply(),o.put("overlay","hidden",{path:"/"})})},e.checkChangedInput=function(t){var o=function(t,o){var a=$('*[name$="-'+t.split("user")[1].toLowerCase()+'"]'),n="warning";o?(a.addClass(n),e.isValid=!1):a.removeClass(n)};return angular.forEach(e.data,function(e,t){o(t,angular.isUndefined(e))}),e.isValid},e.regSubmit=function(a){t({method:"POST",url:formSubmit,data:$.param(angular.extend({formID:"sign"+a},e.data)),headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:angular.identity}).success(function(t){t.result?(o.put("is_signup","true",{path:"/"}),window.location.reload()):(e.loading=!1,e.signInError="The user or password is incorrect")}).error(function(){})},e.changePassword=function(){var o=$('#password-form input[type="password"]');e.data.userRepassword==e.data.userPassword&&""!=e.data.userPassword?(o.removeClass("warning"),t({method:"POST",url:formSubmit,data:$.param({formID:"updatePassw",newPassw:e.data.userPassword}),headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:angular.identity}).success(function(t){switch(t.error){case"":e.closeOverlay();break;default:e.passwordError="Something went wrong, please try again later"}}).error(function(e){})):o.addClass("warning")},e.sendPasswordEmail=function(){t({method:"POST",url:formSubmit,data:$.param({formID:"resetPassw",userEmail:e.data.userEmail}),headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:angular.identity}).success(function(t){switch(t.error){case"":$("#password-form").transition({opacity:0},function(){e.rMessage="reset-password-success",e.$apply()});break;default:e.passwordError="The email does not exist"}}).error(function(e){})},e.$parent.changePassword&&e.switcher("change-password"),e.$parent.resetPassword&&e.switcher("new-password")}),ffAppControllers.controller("NewsletterCtrl",function(e,t,o){
var a="",n=["still","success","error"];e.currentStatus=n[0],e.signUpData={userEmail:""},e.checkChangedInput=function(t){var o=function(e,t){var o=$('*[name$="-'+e.split("user")[1].toLowerCase()+'"]'),a="warning";t?o.addClass(a):o.removeClass(a)};angular.forEach(e.data,function(e,t){o(t,angular.isUndefined(e))})},e.regSubmit=function(){""!=e.signUpData.userEmail&&o({method:"POST",url:formSubmit,data:$.param({formID:"newsletterForm",userEmail:e.signUpData.userEmail}),headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:angular.identity}).success(function(t){e.currentStatus=n[1]}).error(function(){e.currentStatus=n[2]})}}),ffAppControllers.controller("HotelFilterCtrl",function(e,t){var o=$("a.item").toArray(),a=o,n="",r=new Array,i=!0;e.filterHotels=function(e){("f+f favorites"==e||"passported favorites"==e)&&(e=e.split(" ")[1]),angular.forEach(a,function(t){$(t).hasClass(e)||$(t).remove()}),a=$("a.item").toArray()},e.unfilterHotels=function(e){},e.resetFilters=function(){$("a.item").remove(),_.each(o,function(e){$("#hotel-reviews > div.wrapper").append(e)}),$(t[0]).find("li").each(function(){$(this).removeClass("on")})},$(t[0]).find("li").on("click",function(){var t=$(this).text().toLowerCase();switch($(this).toggleClass("on"),$(this).hasClass("on")){case!0:e.filterHotels(t);break;case!1:e.unfilterHotels(t)}return!1}),$('ul[role="select"] li').on("click",function(){e.resetFilters()})}),ffAppControllers.controller("SlideshowCtrl",function(e,t,o,a){var n=$("#"+t[0].id),r=n.find('*[rel="left"]'),i=n.find('*[rel="right"]');$("body").hasClass("hotel")&&(r=$('div.gallery-ui *[rel="left"]'),i=$('div.gallery-ui *[rel="right"]')),a(function(){switch(n.hasClass("one-item")){case!1:break;case!0:n.hasClass("main")&&n.find("li").css({width:$(window).width()+"px"}),n.hasClass("main")?n.find("li").delay(300).transit({opacity:1},function(){n.sly({horizontal:1,itemNav:"forceCentered",smart:1,activateMiddle:1,mouseDragging:1,touchDragging:1,releaseSwing:1,startAt:0,scrollBy:1,speed:500,elasticBounds:1,pagesBar:$("div.gallery-ui ul.pages"),activatePageOn:"click",cycleBy:"items",cycleInterval:7e3,pauseOnHover:!0,startPaused:!1,prev:r,next:i})}):n.find("li").delay(300).transit({opacity:1},function(){n.sly({horizontal:1,itemNav:"centered",activateOn:"click",smart:1,activateMiddle:1,mouseDragging:1,touchDragging:1,releaseSwing:1,startAt:0,scrollBy:1,speed:500,elasticBounds:1,pagesBar:$("div.gallery-ui ul.pages"),activatePageOn:"click",cycleBy:"items",cycleInterval:7e3,pauseOnHover:!0,startPaused:!1,prev:r,next:i})}),$(window).on("resize",function(){n.sly("reload")})}},0)}),ffAppControllers.controller("SearchCtrl",function(e,t){e.userSearch="",e.destinations,e.hotels,e.showResult=!1,e.noResult=!1,e.searchSubmit=function(o){t({method:"POST",url:formSubmit,data:$.param({formID:"customSearch",key:e.userSearch}),headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:angular.identity}).success(function(t){t.destinations.length>0||t.hotels.length>0?(e.showResult=!0,e.destinations=t.destinations,e.hotels=t.hotels):e.userSearch.split("").length>0?(e.showResult=!0,e.noResult=!0):(e.showResult=!1,e.noResult=!1)}).error(function(){})}}),ffAppControllers.controller("HotelCtrl",function(e,t){L.mapbox.accessToken="pk.eyJ1Ijoibm9sb2d5IiwiYSI6IkFBdm5aVEkifQ.ItKi4oQ1-kPhJhedS4QmNg";var o;void 0!=o&&o.remove(),o=L.mapbox.map("map","nology.k0cicjhd",{zoomControl:!0,attributionControl:!1,tileLayer:{continuousWorld:!1,noWrap:!1}}),o.touchZoom.disable(),o.doubleClickZoom.disable(),o.scrollWheelZoom.disable(),o.tap&&o.tap.disable();var a=L.mapbox.featureLayer().addTo(o),n=L.mapbox.featureLayer().addTo(o),r=[];e.latLon,e.showMap=!1,e.step=1,e.addHotel=function(){var t={type:"Feature",geometry:{type:"Point",coordinates:[e.latLon[1],e.latLon[0]]},properties:{title:"",icon:{iconUrl:"/sites/all/themes/feflip/media/icons/destination-map-pin.png",iconSize:[38,47],iconAnchor:[19,47],popupAnchor:[0,-10],className:"ff-Pin"}}};a.on("layeradd",function(e){var t=e.layer,o=t.feature;t.setIcon(L.icon(o.properties.icon))}),r.push(t),a.setGeoJSON(r)},e.addItineraryPins=function(){var e={},o={formID:"addressBook",destinationID:$("#map-it").data("destination")},a={type:"Feature",geometry:{type:"Point",coordinates:[0,0]},properties:{title:"",icon:{iconUrl:"",iconSize:[43,54],iconAnchor:[22,54],popupAnchor:[0,-10],className:"ab-Pin"}}},i=function(){angular.forEach(e,function(e){var t=angular.copy(a);_.isNumber(parseFloat(e.longitude))&&_.isNumber(parseFloat(e.latitude))&&(t.geometry.coordinates[0]=e.longitude,t.geometry.coordinates[1]=e.latitude,t.properties.title=e.title,t.properties.phone=e.phone,t.properties.address=e.address,t.properties.icon.iconUrl="/sites/all/themes/feflip/media/map/"+e.association.toLowerCase()+"-pin.png",t.properties.review=e.review,t.properties.type=e.association.toLowerCase(),r.push(t))}),n.on("layeradd",function(e){var t=e.layer,o=t.feature,a='<div class="'+o.properties.type+'"><h1>'+o.properties.title+"</h1>"+o.properties.review+"</div>";t.setIcon(L.icon(o.properties.icon)),void 0!=o.properties.type&&t.bindPopup(a,{closeButton:!1,minWidth:300,zoomAnimation:!0,keepInView:!0,autoPan:!0})}),n.setGeoJSON(r)};t({method:"POST",url:formSubmit,data:$.param(o),headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:angular.identity}).success(function(t){e=t,i()}).error(function(e,t){})},e.loadMap=function(t,a){e.latLon=[t,a],e.addHotel(),e.addItineraryPins(),o.setView(e.latLon,19)}}),ffAppControllers.controller("ItineraryCtrl",function(e){var t=100;e.scroll=function(e){$("html,body").delay(250).animate({scrollTop:e},500)},$("header button[rel]").on("click",function(){var o=$(this).attr("rel").toLowerCase(),a=$("#neighborhood-guide").offset().top;$("#neighborhood-guide h4").each(function(){$(this).text().toLowerCase()==o&&e.scroll($(this).offset().top-t)})}),$('button[rel="see-hotel-reviews"]').on("click",function(){$(this).fadeOut(),$("#itinerary").css({"padding-bottom":"0px"}),$("#hotel-reviews").removeClass("hidden"),e.scroll($("#hotel-reviews").offset().top-t-40)})}),ffAppControllers.controller("ContactCtrl",function(e,t){e.data={userName:"",userLast:"",userEmail:"",userDepartment:"",userSubject:"",userMessage:""},e.success=!1,e.submitContact=function(){var o={formID:"contact",firstName:e.data.userName,lastName:e.data.userLast,email:e.data.userEmail,department:e.data.userDepartment,subject:e.data.userSubject,message:e.data.userMessage};t({method:"POST",url:formSubmit,data:$.param(o),headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:angular.identity}).success(function(t){$("#contact-form").transition({opacity:0},function(){e.success=!0,e.$apply()})}).error(function(){})}});