"use strict";var formSubmit="https://www.passported.com/api/forms",ppControllers=angular.module("ppControllers",[]),drupalTemplatePath="/sites/all/themes/passported/";ppControllers.controller("AppController",function(a,e,n,t){a.user,a.view,a.loading=!1,a.error=!1,a.resetPassword=!1;var o=function(a){},i=function(){$("body > header").waypoint(function(){var a=$(this);n(function(){a.find('*[data-animate="1"]').addClass("animated fadeInDown")},200),n(function(){a.find('*[data-animate="2"]').addClass("animated fadeInDown")},400),n(function(){a.find('*[data-animate="3"]').addClass("animated fadeInDown")},600),n(function(){a.find('*[data-animate="4"]').addClass("animated fadeInDown")},800),n(function(){a.find('*[data-animate="5"]').addClass("animated fadeInDown")},1e3),n(function(){a.find('*[data-animate="6"]').addClass("animated fadeInDown")},1200),n(function(){a.find('*[data-animate="7"]').addClass("animated fadeIn")},1400),n(function(){a.find('*[data-animate="8"]').addClass("animated fadeIn")},1600)},{offset:"0%"}),$("#passported-intro").waypoint(function(){var a=$(this);n(function(){a.find('*[data-animate="1"]').addClass("animated fadeInUp")},200),n(function(){a.find('*[data-animate="2"]').addClass("animated fadeInUp")},400),n(function(){a.find('*[data-animate="3"]').addClass("animated fadeInUp")},600),n(function(){a.find('*[data-animate="4"]').addClass("animated fadeInUp")},800),n(function(){a.find('*[data-animate="5"]').addClass("animated fadeInUp")},1e3),n(function(){a.find('*[data-animate="6"]').addClass("animated fadeInUp")},1200),n(function(){a.find('*[data-animate="7"]').addClass("animated fadeInUp")},1400)},{offset:"0%"}),$("#inspiration").waypoint(function(){var a=$(this);n(function(){a.find('*[data-animate="1"]').addClass("animated fadeIn")},200),n(function(){a.find('*[data-animate="2"]').addClass("animated fadeIn")},600)},{offset:"100%"}),$("#inspiration").waypoint(function(){},{offset:"90px"}),$("#how-it-works").waypoint(function(){var a=$(this);n(function(){a.find('*[data-animate="1"]').addClass("animated fadeInUp")},200),n(function(){a.find('*[data-animate="2"]').addClass("animated fadeIn")},400),n(function(){a.find('*[data-animate="3"]').addClass("animated fadeIn")},600),n(function(){a.find('*[data-animate="4"]').addClass("animated fadeIn")},800),n(function(){a.find('*[data-animate="5"]').addClass("animated fadeIn")},1e3),n(function(){a.find('*[data-animate="6"]').addClass("animated fadeIn")},1200),n(function(){a.find('*[data-animate="7"]').addClass("animated fadeIn")},1400),n(function(){a.find('*[data-animate="8"]').addClass("animated fadeIn")},1600),n(function(){a.find('*[data-animate="9"]').addClass("animated fadeIn")},1800),n(function(){a.find('*[data-animate="10"]').addClass("animated fadeIn")},2e3)},{offset:"50%"}),$("#newsletter").waypoint(function(){var a=$(this);n(function(){a.find('*[data-animate="1"]').addClass("animated fadeInUp")},200),n(function(){a.find('*[data-animate="2"]').addClass("animated fadeInUp")},600)},{offset:"75%"}),$("#map").waypoint(function(){var a=$(this);e.info("The map is visible now"),o("map"),n(function(){a.find('*[data-animate="1"]').addClass("animated fadeIn")},200),n(function(){a.find('*[data-animate="2"]').addClass("animated fadeInLeft")},400),n(function(){a.find('*[data-animate="3"]').addClass("animated fadeInRight")},600)},{offset:"30%"}),$("#travel-journal").waypoint(function(){var a=$(this);e.info("The blog is visible now"),o("travel-journal"),n(function(){a.find('*[data-animate="1"]').addClass("animated fadeInUp")},200),n(function(){a.find('*[data-animate="2"]').addClass("animated fadeIn")},400)},{offset:"75%"}),$("#press").waypoint(function(){var a=$(this);e.info("The press block is visible now"),o("press"),n(function(){a.find('*[data-animate="1"]').addClass("animated fadeInDown")},200),n(function(){a.find('*[data-animate="2"]').addClass("animated fadeInDown")},400),n(function(){a.find('*[data-animate="3"]').addClass("animated fadeInDown")},600),n(function(){a.find('*[data-animate="4"]').addClass("animated fadeInDown")},800),n(function(){a.find('*[data-animate="5"]').addClass("animated fadeInDown")},1e3),n(function(){a.find('*[data-animate="6"]').addClass("animated fadeInDown")},1200),n(function(){a.find('*[data-animate="7"]').addClass("animated fadeInDown")},1400),n(function(){a.find('*[data-animate="8"]').addClass("animated fadeInDown")},1600)},{offset:"75%"}),$("body > footer").waypoint(function(){var a=$(this);e.info("The footer is visible now"),n(function(){a.find('*[data-animate="1"]').addClass("animated fadeInDown")},200)},{offset:"75%"})},s=function(){var a=$("div.dropdown-wrapper"),e=a.find("div.arrow"),t=$("#city-guides-list"),o=$("#search-block"),i=300,s=$(window).height()-90,r=!1,d=function(){n(function(){a.find('*[data-animate="1"]').addClass("animated fadeInUp")},200),n(function(){a.find('*[data-animate="2"]').addClass("animated fadeInUp")},400),n(function(){a.find('*[data-animate="3"]').addClass("animated fadeInUp")},600),n(function(){a.find('*[data-animate="4"]').addClass("animated fadeInUp")},800)},l=function(){};$("div.dropdown-wrapper").on({mouseover:function(){r=!0}}),$("header > nav a.subnav").on({mouseover:function(){var n=$(this).offset().left+30-10+$(this).width()/2,d;switch(r=!0,$(this).attr("id")){case"city-guides":a.removeClass("light"),d="city-guides";break;case"search":a.addClass("light"),d="search"}setTimeout(function(){r&&(e.css({left:n+"px"}).addClass("on"),"city-guides"==d&&(a.show().transition({height:s+"px"}),t.show().transition({opacity:1}),o.hide()),"search"==d&&(a.show().transition({height:"220px"}),o.show().transition({opacity:1}),t.hide()))},i)}}),$("header > nav a.subnav, div.dropdown-wrapper").on({mouseout:function(){r=!1,setTimeout(function(){r||(e.removeClass("on"),a.transition({height:0},function(){a.hide()}),t.transition({opacity:0},function(){t.hide()}),o.transition({opacity:0},function(){o.hide()}))},i)}})},r=function(){$("body").imagesLoaded().always(function(a){$("body").transit({opacity:1},function(){i(),s()})})};a.state=t.path().replace("/",""),a.goToURL=function(a){window.location=a},n(function(){r()},200)}),ppControllers.controller("MapController",function(a,e,n){a.map,a.lat=30,a.lon=-30,a.inspirationSearch;var t="passported",o=function(){$("#map").css({height:$(window).height()-90+"px"})},i=function(){var e={zoom:3,center:new google.maps.LatLng(a.lat,a.lon),zoomControl:!0,mapTypeControl:!1,scrollwheel:!1,scaleControl:!0,streetViewControl:!0,overviewMapControl:!1,panControl:!1,panControlOptions:{position:google.maps.ControlPosition.TOP_RIGHT},zoomControlOptions:{style:google.maps.ZoomControlStyle.SMALL,position:google.maps.ControlPosition.RIGHT_TOP},mapTypeControlOptions:{mapTypeIds:[google.maps.MapTypeId.ROADMAP,t]},mapTypeId:t},n=[{stylers:[{hue:"#D8DCDB"},{visibility:"simplified"},{gamma:0},{weight:.5}]},{elementType:"labels",stylers:[{visibility:"on"},{color:"#AAAAAA"}]},{featureType:"water",stylers:[{color:"#BBCAD0"}]},{featureType:"road",stylers:[{color:"#D8DCDB"}]},{featureType:"transit",elementType:"geometry",stylers:[{color:"#D8DCDB"}]},{featureType:"landscape",elementType:"geometry",stylers:[{color:"#F0F2F1"}]},{featureType:"poi",elementType:"geometry",stylers:[{color:"#F0F2F1"}]}],o={name:"Passported"};a.map=new google.maps.Map(document.getElementById("google-maps-container"),e),a.map.mapTypes.set(t,new google.maps.StyledMapType(n,o))};a.addMarkers=function(e,n){var t="/sites/all/themes/passported/media/icons/";switch(e){case"destinations":_.map(n,function(e){var n=new google.maps.Marker({position:{lat:Number(e.lat),lng:Number(e.lon)},map:a.map,title:e.name,icon:t+"map-pin-icon.svg"});n.addListener("click",function(){a.map.setZoom(15),a.map.setCenter(n.getPosition())})});break;case"guide":var o=0==n.zoom_level.length?12:Number(n.zoom_level),i=0==n.addressbook_reference.length?[n.lat,n.lon]:[n.addressbook_reference.lat,n.addressbook_reference.lon],s=[n.guide,n.hotels];_.map(s,function(e){_.map(e,function(e){var n=_.isUndefined(e.assoc_interests)?"map":e.assoc_interests.toLowerCase(),o=new google.maps.Marker({position:{lat:Number(e.lat),lng:Number(e.lon)},map:a.map,title:e.title,icon:t+n+"-pin-icon.svg"}),i=new google.maps.InfoWindow({content:'<div class="in-map '+n+'"><h1>'+e.title+"</h1><h2>"+e.short_review+"</h2></div>",maxWidth:200});o.addListener("click",function(){a.map.setZoom(16),a.map.setCenter(o.getPosition()),i.open(a.map,o)})})}),a.map.setCenter(new google.maps.LatLng(Number(i[0]),Number(i[1]))),a.map.setZoom(o)}},n(function(){o(),i()},0),$(window).on("resize",function(){o()})}),ppControllers.controller("ItineraryController",function(a,e,n,t,o,i,s){var r=t("https://www.passported.com/api/content/destinations.json"),d=t("https://www.passported.com/api/content/address-books.json"),l=t("https://www.passported.com/api/content/hotels.json"),c=t("https://gostage.passported.com/api/v2/location");if(a.itineraryIsReady,a.cityGuideID,a.step=_.isUndefined(a.cityGuideID)?1:2,a.pick,a.showAside=!0,a.filter=void 0,a.hotelFilters=[],a.addressFilters={eat:[],"do":[],noteworthy:[],shop:[]},a.check={phone:function(a){return _.isArray(a)},features:function(a){return _.isArray(a)}},a.setClass=function(a){var e="";return _.map(a,function(a){_.each(a,function(n,t){var o=t==a.length-1?"":" ";e+=n.toLowerCase()+o})}),e},a.openLeftAside=function(){a.showAside=!a.showAside},a.goTo=function(e){a.step=e},a.displayDestination=function(e){a.pick=e,("stage.passported.com"==window.location.host||"www.passported.com"==window.location.host)&&c.get({name:e.name},function(a){}),d.query({destination:e.id},function(n){a.pick.guide=n,_.extend(a.pick,{guide_by_category:angular.copy(a.addressFilters)}),_.map(n,function(e){if(_.isUndefined(a.pick.guide_by_category[e.assoc_interests.toLowerCase()])||a.pick.guide_by_category[e.assoc_interests.toLowerCase()].push(e),!_.isArray(e.google_place_id)){var n=new google.maps.places.PlacesService(a.map);n.getDetails({placeId:e.google_place_id},function(a,n){n==google.maps.places.PlacesServiceStatus.OK&&(console.log(e),console.log(a),e.title=a.name,e.lat=a.geometry.location.G,e.lon=a.geometry.location.K,e.phone_number=a.formatted_phone_number,e.address=a.formatted_address,e.website=a.website,e.hours=a.opening_hours.weekday_text)})}_.map(e.guide_categories,function(e,n){var t=n.toLowerCase();_.map(e,function(e){-1==_.indexOf(a.addressFilters[t],e.toLowerCase())&&a.addressFilters[t].push(e.toLowerCase())})})}),l.query({destination:e.id},function(n){a.pick.hotels=n,a.$parent.addMarkers("guide",e),_.map(a.pick.hotels,function(e){_.map(e.guide_categories,function(e){_.map(e,function(e){-1==_.indexOf(a.hotelFilters,e.toLowerCase())&&a.hotelFilters.push(e.toLowerCase())})})})})}),a.step=2,$("#step-2").delay(2e3).transition({opacity:1},"slow",function(){a.itineraryIsReady=!0,a.$apply()})},_.isUndefined(a.cityGuideID)&&_.isUndefined(a.inspirationSearch))a.destinations=r.query({},function(e){a.$parent.addMarkers("destinations",e)});else if(_.isUndefined(a.cityGuideID)){if(!_.isUndefined(a.inspirationSearch)){var u=o.search();a.destinations=r.query({place_type:u.place,season:u.season},function(e){a.$parent.addMarkers("destinations",e)})}}else a.pick=r.query({id:a.cityGuideID},function(e){a.displayDestination(e[0])});a.filterMap=function(e){a.filter=e},a.book=function(a){s.$emit("open-booking",[a])},s.$on("filter",function(a){})}),ppControllers.controller("BookingController",function(a,e,n,t,o){var i={formID:"bookHotel",destination:"",hotel:"",name:void 0,last:void 0,email:void 0,start_date:void 0,end_date:void 0,adults:0,children:0,budget:void 0,specific_budget:void 0,message:void 0};a.error,a.showRightAside=!1,a.showCalendar=!1,a.booking=angular.copy(i),a.openAside=function(){a.showRightAside=!a.showRightAside,a.showRightAside||(a.booking=angular.copy(i))},a.setter={checkButtons:function(){$("*.budget-check").on("click",function(){return $("*.budget-check span").removeClass("on"),$(this).find("span").toggleClass("on"),!1})},calendarButtons:function(){$("*.icon-calendar").on("click",function(){return a.showCalendar=!0,a.$apply(),!1})},date:function(){},budget:function(e){a.booking.budget=e}},a.submit=function(){$("aside.right #step-1 ul li").transition({opacity:0},function(){$(this).hide()}),t({method:"POST",url:formSubmit,data:$.param(a.booking),headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:angular.identity}).success(function(a){$("#booking-message").show().transition({opacity:1})}).error(function(){})},o.$on("open-booking",function(e,n){a.showRightAside=!0,a.booking.destination=n[0].destination,a.booking.hotel=n[0].name}),a.$watch("booking",function(n,t){_.isEqual(n,t)||_.map(n,function(o,i){if(n[i]!=t[i])switch(e.info(i+" has changed"),i){case"start_date":case"end_date":_.isUndefined(a.booking.start_date)||_.isUndefined(a.booking.end_date)||(moment(a.booking.end_date).isBefore(a.booking.start_date)?a.error="Please make sure you have selected correct dates":a.error=!1);break;case"adults":_.isUndefined(a.booking.adults)||0==a.booking.adults?a.error="Please make sure you have selected correct adults":a.error=!1}})},!0),n(function(){a.setter.checkButtons(),a.setter.calendarButtons()},0)}),ppControllers.controller("CalendarController",function(a,e,n){var t=$("#arrival-gallery"),o=$("#departure-gallery");a.year=[],a.getMonth=function(a,e){var n=e,t=new Date(n,a,1),o=new Date(n,a,moment(n+"-"+(a+1),"YYYY-MM").daysInMonth()),i=moment().range(t,o),s={start:0==t.getDay()?6:t.getDay()-1,days:{}};return i.by("days",function(a){s.days[moment(a._d).format("DD")]=moment(a._d).format("MM/DD/YYYY")}),s},a.buildYear=function(){var e=moment().get("year"),n=moment().get("month"),t=new Date(e,n,1),o=new Date(e+1,n,moment(e+1+"-"+n,"YYYY-MM").daysInMonth()),i=moment().range(t,o),s=[];i.by("months",function(e){var n=moment(e._d).get("month"),t=moment(e._d).get("year");a.year.push({name:moment(e._d).format("MMMM")+" "+t,order:a.getMonth(n,t)})})},n(function(){var e=function(e){e.sly({horizontal:1,itemNav:"forceCentered",smart:1,activateMiddle:1,mouseDragging:1,touchDragging:0,releaseSwing:1,startAt:0,scrollBy:1,speed:500,elasticBounds:1,prev:e.find('*[rel="prev"]'),next:e.find('*[rel="next"]')}),e.find("button").on("click",function(){switch($(this).hasClass("arrival")){case!0:a.booking.start_date=$(this).data("date"),$("#arrival button[data-date]").removeClass("on");break;case!1:a.booking.end_date=$(this).data("date"),$("#departure button[data-date]").removeClass("on")}return $(this).addClass("on"),a.$apply(),!1})};e(t),e(o)},0),a.buildYear()}),ppControllers.controller("BlogController",function(a,e,n){var t=$(".grid-wrapper"),o=$(".grid-wrapper *.quick-entry").toArray();a.expand="view all",a.viewAll=function(){var e="view all"==a.expand?["view less","auto"]:["view all","1400px"];a.expand=e[0],$("#travel-journal").css({height:e[1]})},n(function(){t.shuffle({itemSelector:".quick-entry"})},0)}),ppControllers.controller("PromotedController",function(a,e,n,t){}),ppControllers.controller("NewsletterController",function(a,e,n){var t="",o=["still","success","error"];a.currentStatus=o[0],a.signUpData={userEmail:""},a.checkChangedInput=function(e){var n=function(a,e){var n=$('*[name$="-'+a.split("user")[1].toLowerCase()+'"]'),t="warning";e?n.addClass(t):n.removeClass(t)};angular.forEach(a.data,function(a,e){n(e,angular.isUndefined(a))})},a.regSubmit=function(){""!=a.signUpData.userEmail&&$http({method:"POST",url:formSubmit,data:$.param({formID:"newsletterForm",userEmail:a.signUpData.userEmail}),headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:angular.identity}).success(function(e){a.currentStatus=o[1]}).error(function(){a.currentStatus=o[2]})}}),ppControllers.controller("SearchController",function(a,e,n,t){var o;a.userSearch="",a.destinations,a.hotels,a.showResult=!1,a.noResult=!1,a.reset=function(){a.userSearch="",a.$apply()},a.searchSubmit=function(){var e=function(){n({method:"POST",url:formSubmit,data:$.param({formID:"customSearch",key:a.userSearch}),headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:angular.identity}).success(function(e){e.destinations.length>0||e.hotels.length>0?(a.showResult=!0,a.destinations=e.destinations,a.hotels=e.hotels):a.userSearch.split("").length>0?(a.showResult=!0,a.noResult=!0):(a.showResult=!1,a.noResult=!1)}).error(function(){})};o&&clearTimeout(o),o=setTimeout(function(){e()},500)}}),ppControllers.controller("InspirationController",function(a,e,n,t,o){a.search={place:void 0,season:void 0},a.submitInspiration=function(){window.location=window.location.origin+"/inspiration/#/?place="+a.search.place+"&season="+a.search.season}}),ppControllers.controller("CallToActionController",function(a,e,n,t,o){var i=["hidden","signup","loading"],s=$(".call-to-action");a.overlayTpl=drupalTemplatePath+"library/templates/sign.tpl.html",a.isLoggedIn=a.user,a.isLoading=a.loading,a.triggerState=i[0],a.isSignPage=a.view,a.types=["sign-up","sign-in","response","reset-password","new-password","change-password"],a.type=a.types[0],a.display=!1,a.resetPassword=a.resetPassword,a.changePassword=!1,a.triggerOverlay=function(){switch(a.triggerState){case"hidden":a.display=!1;break;default:a.display=!0,a.$apply()}},a.$watch("isLoggedIn",function(a){}),a.$watch("isSignPage",function(e){("sign-in"==e||"sign-up"==e)&&t(function(){a.type=e,a.triggerState=i[1],a.triggerOverlay(),$(".call-to-action").show().transition({opacity:1})},0)}),a.$watch("resetPassword",function(e){e&&(a.triggerState=i[1],a.triggerOverlay())}),a.$watch("changePassword",function(e){e&&(a.triggerState=i[1],a.triggerOverlay())}),a.$watch("isLoading",function(e){e&&(a.triggerState=i[3],a.triggerOverlay())}),e.$on("display-overlay",function(e,n){a.user||(a.triggerState=i[1],a.triggerOverlay(),$(".call-to-action").show().transition({opacity:1}))}),$("#change-password").on("click",function(e){a.changePassword=!0,a.$apply(),e.preventDefault()}),$("#sign-in").on("click",function(n){e.$emit("display-overlay",""),a.type=a.types[1],a.$apply(),n.preventDefault()}),$("#sign-up").on("click",function(n){e.$emit("display-overlay",""),a.type=a.types[0],a.$apply(),n.preventDefault()})}),ppControllers.controller("SignController",function(a,e,n){a.response=["success","error","error-in-login"],a.rMessage="",a.isValid=!0,a.signInError="",a.signUpError="",a.passwordError="",a.loading=!1,a.data={userName:"",userLast:"",userEmail:"",userPassword:"",userRepassword:"",subscribeNewsletter:!0},a.switcher=function(e){a.type=e,a.data={userName:"",userLast:"",userEmail:"",userPassword:"",userRepassword:"",subscribeNewsletter:!0},a.signInError="",a.signUpError="",a.passwordError="",a.rMessage=""},a.closeOverlay=function(){$(".call-to-action").transition({opacity:0},function(){$(this).hide()})},a.checkChangedInput=function(e){var n=function(e,n){var t=$('*[name$="-'+e.split("user")[1].toLowerCase()+'"]'),o="warning";n?(t.addClass(o),a.isValid=!1):t.removeClass(o)};return angular.forEach(a.data,function(a,e){n(e,angular.isUndefined(a))}),a.isValid},a.regSubmit=function(n){e({method:"POST",url:formSubmit,data:$.param(angular.extend({formID:"sign"+n},a.data)),headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:angular.identity}).success(function(e){if(e.result){var n=$(document)[0].referrer.split(".passported.com");n.length>1?window.location=$(document)[0].referrer:window.location.reload()}else a.loading=!1,a.signInError="The user or password is incorrect"}).error(function(){})},a.changePassword=function(){var n=$('#password-form input[type="password"]');a.data.userRepassword==a.data.userPassword&&""!=a.data.userPassword?(n.removeClass("warning"),e({method:"POST",url:formSubmit,data:$.param({formID:"updatePassw",newPassw:a.data.userPassword}),headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:angular.identity}).success(function(e){switch(e.error){case"":a.closeOverlay();break;default:a.passwordError="Something went wrong, please try again later"}}).error(function(a){})):n.addClass("warning")},a.sendPasswordEmail=function(){e({method:"POST",url:formSubmit,data:$.param({formID:"resetPassw",userEmail:a.data.userEmail}),headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:angular.identity}).success(function(e){switch(e.error){case"":$("#password-form").transition({opacity:0},function(){a.rMessage="reset-password-success",a.$apply()});break;default:a.passwordError="The email does not exist"}}).error(function(a){})},a.$parent.changePassword&&a.switcher("change-password"),a.$parent.resetPassword&&a.switcher("new-password")}),ppControllers.controller("ContactController",function(a,e){a.data={userName:"",userLast:"",userEmail:"",userDepartment:"",userSubject:"",userMessage:""},a.success=!1,a.submitContact=function(){var n={formID:"contact",firstName:a.data.userName,lastName:a.data.userLast,email:a.data.userEmail,department:a.data.userDepartment,subject:a.data.userSubject,message:a.data.userMessage};e({method:"POST",url:formSubmit,data:$.param(n),headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:angular.identity}).success(function(e){$("#contact-form").transition({opacity:0},function(){a.success=!0,a.$apply()})}).error(function(){})}});